# é—®é¢˜ç®€ä»‹

[LeetCode 148. æ’åºé“¾è¡¨](https://leetcode.cn/problems/sort-list?envType=problem-list-v2&envId=2cktkvj)

## é¢˜ç›®æè¿°

ç»™ä½ é“¾è¡¨çš„å¤´ç»“ç‚¹ `head` ï¼Œè¯·å°†å…¶æŒ‰ **å‡åº** æ’åˆ—å¹¶è¿”å› **æ’åºåçš„é“¾è¡¨** ã€‚

**è¿›é˜¶ï¼š** ä½ å¯ä»¥åœ¨ `O(n log n)` æ—¶é—´å¤æ‚åº¦å’Œå¸¸æ•°çº§ç©ºé—´å¤æ‚åº¦ä¸‹ï¼Œå¯¹é“¾è¡¨è¿›è¡Œæ’åºå—ï¼Ÿ

______________________________________________________________________

## ç¤ºä¾‹è¯´æ˜

### ç¤ºä¾‹ 1ï¼š

```
è¾“å…¥ï¼šhead = [4,2,1,3]
è¾“å‡ºï¼š[1,2,3,4]
```

### ç¤ºä¾‹ 2ï¼š

```
è¾“å…¥ï¼šhead = [-1,5,3,4,0]
è¾“å‡ºï¼š[-1,0,3,4,5]
```

### ç¤ºä¾‹ 3ï¼š

```
è¾“å…¥ï¼šhead = []
è¾“å‡ºï¼š[]
```

______________________________________________________________________

## è§£é¢˜æ€è·¯

### âœ… æ–¹æ³•ä¸€ï¼šè‡ªé¡¶å‘ä¸‹å½’å¹¶æ’åºï¼ˆTop-down Merge Sortï¼‰

ğŸ“Œ **æ ¸å¿ƒæ€æƒ³**ï¼š\
å°†é“¾è¡¨ä¸æ–­äºŒåˆ†ï¼Œç›´åˆ°æ¯ä¸ªå­é“¾è¡¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæˆ–ä¸ºç©ºï¼‰ï¼Œç„¶åé€å±‚åˆå¹¶å·²æ’åºçš„å­é“¾è¡¨ã€‚

ğŸ’¡ **å…³é”®æ­¥éª¤**ï¼š

1. **æ‰¾ä¸­ç‚¹**ï¼šä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ³•æ‰¾åˆ°é“¾è¡¨ä¸­ç‚¹ã€‚
1. **æ–­å¼€é“¾è¡¨**ï¼šå°†é“¾è¡¨ä»ä¸­ç‚¹æ–­å¼€ä¸ºå·¦å³ä¸¤éƒ¨åˆ†ã€‚
1. **é€’å½’æ’åº**ï¼šå¯¹å·¦å³ä¸¤éƒ¨åˆ†åˆ†åˆ«é€’å½’æ’åºã€‚
1. **åˆå¹¶æœ‰åºé“¾è¡¨**ï¼šå°†ä¸¤ä¸ªå·²æ’åºçš„å­é“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæœ‰åºé“¾è¡¨ã€‚

> âš ï¸ æ³¨æ„ï¼šæ­¤æ–¹æ³•ç”±äºé€’å½’è°ƒç”¨æ ˆï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(log n)ï¼Œä¸æ»¡è¶³â€œå¸¸æ•°çº§ç©ºé—´å¤æ‚åº¦â€çš„è¿›é˜¶è¦æ±‚ï¼Œä½†æ—¶é—´å¤æ‚åº¦ä¸º O(n log n)ã€‚

______________________________________________________________________

### âœ… æ–¹æ³•äºŒï¼šè‡ªåº•å‘ä¸Šå½’å¹¶æ’åºï¼ˆBottom-up Merge Sortï¼‰

ğŸ“Œ **æ ¸å¿ƒæ€æƒ³**ï¼š\
ä¸ä½¿ç”¨é€’å½’ï¼Œè€Œæ˜¯ä»é•¿åº¦ä¸º 1 çš„å­é“¾è¡¨å¼€å§‹ï¼Œé€å±‚åˆå¹¶æˆé•¿åº¦ä¸º 2ã€4ã€8... çš„æœ‰åºå­é“¾è¡¨ï¼Œç›´åˆ°æ•´ä¸ªé“¾è¡¨æœ‰åºã€‚

ğŸ’¡ **å…³é”®æ­¥éª¤**ï¼š

1. **è®¡ç®—é“¾è¡¨é•¿åº¦**ã€‚
1. **å¤–å±‚å¾ªç¯**ï¼šå­é“¾è¡¨é•¿åº¦ `step` ä» 1 å¼€å§‹ï¼Œæ¯æ¬¡ç¿»å€ï¼Œç›´åˆ° `step >= length`ã€‚
1. **å†…å±‚å¾ªç¯**ï¼šæ¯æ¬¡å–ä¸¤ä¸ªé•¿åº¦ä¸º `step` çš„å­é“¾è¡¨ï¼Œåˆå¹¶å®ƒä»¬ã€‚
1. **æ‹¼æ¥åˆå¹¶ç»“æœ**åˆ°æ–°é“¾è¡¨ä¸­ã€‚

> âœ… æ­¤æ–¹æ³•æ»¡è¶³ O(n log n) æ—¶é—´å¤æ‚åº¦ + O(1) ç©ºé—´å¤æ‚åº¦ï¼Œç¬¦åˆè¿›é˜¶è¦æ±‚ã€‚

______________________________________________________________________

### âŒ å…¶ä»–æ–¹æ³•ï¼ˆä¸æ¨èï¼‰

- **è½¬æ•°ç»„æ’åºå†é‡å»ºé“¾è¡¨**ï¼šè™½ç„¶ç®€å•ï¼Œä½†ç©ºé—´å¤æ‚åº¦ O(n)ï¼Œä¸”ç ´åäº†â€œé“¾è¡¨åŸåœ°æ“ä½œâ€çš„ç²¾ç¥ã€‚
- **å¿«é€Ÿæ’åº**ï¼šé“¾è¡¨ä¸æ”¯æŒéšæœºè®¿é—®ï¼Œpartition æ“ä½œæ•ˆç‡ä½ï¼Œæœ€åæ—¶é—´å¤æ‚åº¦ O(nÂ²)ã€‚

______________________________________________________________________

## ä»£ç å®ç°

```java
// æ–¹æ³•ä¸€ï¼šè‡ªé¡¶å‘ä¸‹å½’å¹¶æ’åº
class Solution {
    public ListNode sortList(ListNode head) {
        if (head == null || head.next == null) return head;
        
        // å¿«æ…¢æŒ‡é’ˆæ‰¾ä¸­ç‚¹
        ListNode slow = head, fast = head, prev = null;
        while (fast != null && fast.next != null) {
            prev = slow;
            slow = slow.next;
            fast = fast.next.next;
        }
        prev.next = null; // æ–­å¼€é“¾è¡¨
        
        // é€’å½’æ’åºå·¦å³ä¸¤éƒ¨åˆ†
        ListNode left = sortList(head);
        ListNode right = sortList(slow);
        
        // åˆå¹¶
        return merge(left, right);
    }
    
    private ListNode merge(ListNode l1, ListNode l2) {
        ListNode dummy = new ListNode(0);
        ListNode cur = dummy;
        while (l1 != null && l2 != null) {
            if (l1.val <= l2.val) {
                cur.next = l1;
                l1 = l1.next;
            } else {
                cur.next = l2;
                l2 = l2.next;
            }
            cur = cur.next;
        }
        cur.next = (l1 != null) ? l1 : l2;
        return dummy.next;
    }
}

// æ–¹æ³•äºŒï¼šè‡ªåº•å‘ä¸Šå½’å¹¶æ’åºï¼ˆæ»¡è¶³ O(1) ç©ºé—´ï¼‰
class Solution2 {
    public ListNode sortList(ListNode head) {
        if (head == null || head.next == null) return head;
        
        // è®¡ç®—é“¾è¡¨é•¿åº¦
        int len = 0;
        ListNode cur = head;
        while (cur != null) {
            len++;
            cur = cur.next;
        }
        
        ListNode dummy = new ListNode(0);
        dummy.next = head;
        
        // step ä» 1 å¼€å§‹ï¼Œæ¯æ¬¡ç¿»å€
        for (int step = 1; step < len; step *= 2) {
            ListNode prev = dummy;
            cur = dummy.next;
            
            while (cur != null) {
                ListNode left = cur;
                
                // æ‰¾å³åŠéƒ¨åˆ†èµ·ç‚¹
                for (int i = 1; i < step && cur != null; i++) {
                    cur = cur.next;
                }
                if (cur == null) break;
                
                ListNode right = cur.next;
                cur.next = null; // æ–­å¼€ left
                cur = right;
                
                // æ‰¾ right çš„ç»“å°¾
                for (int i = 1; i < step && cur != null; i++) {
                    cur = cur.next;
                }
                ListNode next = null;
                if (cur != null) {
                    next = cur.next;
                    cur.next = null; // æ–­å¼€ right
                }
                
                // åˆå¹¶ left å’Œ right
                ListNode merged = merge(left, right);
                prev.next = merged;
                
                // ç§»åŠ¨ prev åˆ° merged æœ«å°¾
                while (prev.next != null) {
                    prev = prev.next;
                }
                cur = next;
            }
        }
        return dummy.next;
    }
    
    private ListNode merge(ListNode l1, ListNode l2) {
        ListNode dummy = new ListNode(0);
        ListNode cur = dummy;
        while (l1 != null && l2 != null) {
            if (l1.val <= l2.val) {
                cur.next = l1;
                l1 = l1.next;
            } else {
                cur.next = l2;
                l2 = l2.next;
            }
            cur = cur.next;
        }
        cur.next = (l1 != null) ? l1 : l2;
        return dummy.next;
    }
}
```

```go
// æ–¹æ³•ä¸€ï¼šè‡ªé¡¶å‘ä¸‹å½’å¹¶æ’åº
func sortList(head *ListNode) *ListNode {
    if head == nil || head.Next == nil {
        return head
    }
    
    // å¿«æ…¢æŒ‡é’ˆæ‰¾ä¸­ç‚¹
    slow, fast := head, head
    var prev *ListNode
    for fast != nil && fast.Next != nil {
        prev = slow
        slow = slow.Next
        fast = fast.Next.Next
    }
    prev.Next = nil // æ–­å¼€
    
    left := sortList(head)
    right := sortList(slow)
    
    return merge(left, right)
}

func merge(l1, l2 *ListNode) *ListNode {
    dummy := &ListNode{}
    cur := dummy
    for l1 != nil && l2 != nil {
        if l1.Val <= l2.Val {
            cur.Next = l1
            l1 = l1.Next
        } else {
            cur.Next = l2
            l2 = l2.Next
        }
        cur = cur.Next
    }
    if l1 != nil {
        cur.Next = l1
    } else {
        cur.Next = l2
    }
    return dummy.Next
}

// æ–¹æ³•äºŒï¼šè‡ªåº•å‘ä¸Šå½’å¹¶æ’åº
func sortList2(head *ListNode) *ListNode {
    if head == nil || head.Next == nil {
        return head
    }
    
    // è®¡ç®—é•¿åº¦
    length := 0
    cur := head
    for cur != nil {
        length++
        cur = cur.Next
    }
    
    dummy := &ListNode{Next: head}
    
    for step := 1; step < length; step *= 2 {
        prev := dummy
        cur = dummy.Next
        
        for cur != nil {
            left := cur
            
            // æ‰¾ right èµ·ç‚¹
            for i := 1; i < step && cur != nil; i++ {
                cur = cur.Next
            }
            if cur == nil {
                break
            }
            
            right := cur.Next
            cur.Next = nil
            cur = right
            
            // æ‰¾ right ç»“å°¾
            for i := 1; i < step && cur != nil; i++ {
                cur = cur.Next
            }
            var next *ListNode
            if cur != nil {
                next = cur.Next
                cur.Next = nil
            }
            
            merged := merge(left, right)
            prev.Next = merged
            
            // ç§»åŠ¨ prev åˆ° merged æœ«å°¾
            for prev.Next != nil {
                prev = prev.Next
            }
            cur = next
        }
    }
    return dummy.Next
}
```

______________________________________________________________________

## ç¤ºä¾‹æ¼”ç¤º

ä»¥ `head = [4,2,1,3]` ä¸ºä¾‹ï¼š

### è‡ªé¡¶å‘ä¸‹è¿‡ç¨‹ï¼š

```
[4,2,1,3]
   â†“ åˆ†
[4,2]     [1,3]
  â†“ åˆ†      â†“ åˆ†
[4] [2]   [1] [3]
  â†“ åˆ      â†“ åˆ
[2,4]     [1,3]
   â†“ åˆ
[1,2,3,4]
```

### è‡ªåº•å‘ä¸Šè¿‡ç¨‹ï¼š

```
åˆå§‹: 4â†’2â†’1â†’3
step=1:
  åˆå¹¶ [4] å’Œ [2] â†’ [2,4]
  åˆå¹¶ [1] å’Œ [3] â†’ [1,3]
  é“¾è¡¨: 2â†’4â†’1â†’3
step=2:
  åˆå¹¶ [2,4] å’Œ [1,3] â†’ [1,2,3,4]
å®Œæˆ
```

______________________________________________________________________

## ç­”æ¡ˆæœ‰æ•ˆæ€§è¯æ˜

âœ… **æ­£ç¡®æ€§**ï¼š

- å½’å¹¶æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•ï¼Œé€‚ç”¨äºé“¾è¡¨ã€‚
- åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨çš„æ“ä½œä¿è¯äº†å±€éƒ¨æœ‰åºæ€§ä¼ é€’åˆ°å…¨å±€ã€‚
- è‡ªåº•å‘ä¸Šæ–¹æ³•é€šè¿‡é€æ­¥æ‰©å¤§æœ‰åºæ®µé•¿åº¦ï¼Œæœ€ç»ˆè¦†ç›–æ•´ä¸ªé“¾è¡¨ã€‚

âœ… **è¾¹ç•Œå¤„ç†**ï¼š

- ç©ºé“¾è¡¨æˆ–å•èŠ‚ç‚¹é“¾è¡¨ç›´æ¥è¿”å›ã€‚
- å¥‡æ•°é•¿åº¦é“¾è¡¨åœ¨åˆ†å‰²æ—¶ï¼Œå·¦åŠéƒ¨åˆ†å¤šä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸å½±å“åˆå¹¶é€»è¾‘ã€‚

______________________________________________________________________

## å¤æ‚åº¦åˆ†æ

| æ–¹æ³• | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | æ˜¯å¦æ»¡è¶³è¿›é˜¶è¦æ±‚ |
|------|------------|------------|------------------|
| è‡ªé¡¶å‘ä¸‹å½’å¹¶ | O(n log n) | O(log n)ï¼ˆé€’å½’æ ˆï¼‰ | âŒ |
| è‡ªåº•å‘ä¸Šå½’å¹¶ | O(n log n) | O(1) | âœ… |

- **æ—¶é—´å¤æ‚åº¦**ï¼šæ¯å±‚åˆå¹¶ O(n)ï¼Œå…± log n å±‚ â†’ O(n log n)
- **ç©ºé—´å¤æ‚åº¦**ï¼š
  - è‡ªé¡¶å‘ä¸‹ï¼šé€’å½’æ·±åº¦ log n â†’ O(log n)
  - è‡ªåº•å‘ä¸Šï¼šä»…ä½¿ç”¨å¸¸æ•°é¢å¤–æŒ‡é’ˆ â†’ O(1)

______________________________________________________________________

## é—®é¢˜æ€»ç»“

ğŸ“Œ **å…³é”®æ”¶è·**ï¼š

- é“¾è¡¨æ’åºé¦–é€‰ **å½’å¹¶æ’åº**ï¼Œå› å…¶å¤©ç„¶é€‚åˆé¡ºåºè®¿é—®ç»“æ„ã€‚
- **å¿«æ…¢æŒ‡é’ˆ** æ˜¯é“¾è¡¨ä¸­æ‰¾ä¸­ç‚¹çš„æ ‡å‡†æŠ€å·§ã€‚
- **è‡ªåº•å‘ä¸Šå½’å¹¶** æ˜¯æ»¡è¶³ O(1) ç©ºé—´çš„æœ€ä¼˜è§£ï¼Œè™½ä»£ç ç¨å¤æ‚ï¼Œä½†å€¼å¾—æŒæ¡ã€‚
- é¢è¯•ä¸­è‹¥æœªæ˜ç¡®è¦æ±‚ O(1) ç©ºé—´ï¼Œå¯å…ˆå†™è‡ªé¡¶å‘ä¸‹ç‰ˆæœ¬ï¼ˆæ›´ç®€æ´ï¼‰ï¼Œå†ä¼˜åŒ–ä¸ºè‡ªåº•å‘ä¸Šã€‚

ğŸ’¡ **å»¶ä¼¸æ€è€ƒ**ï¼š

- è‹¥é“¾è¡¨å¸¦ç¯ï¼Ÿéœ€å…ˆæ£€æµ‹å¹¶æ–­ç¯ã€‚
- è‹¥è¦æ±‚ç¨³å®šæ’åºï¼Ÿå½’å¹¶æ’åºå¤©ç„¶ç¨³å®šã€‚
- è‹¥æ•°æ®èŒƒå›´å°ï¼Ÿå¯è€ƒè™‘è®¡æ•°æ’åºï¼ˆä½†ä¸€èˆ¬ä¸é€‚ç”¨ï¼‰ã€‚
