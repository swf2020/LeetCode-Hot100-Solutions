# é—®é¢˜ç®€ä»‹

[152. ä¹˜ç§¯æœ€å¤§å­æ•°ç»„ - LeetCode](https://leetcode.cn/problems/maximum-product-subarray?envType=problem-list-v2&envId=2cktkvj)

## é¢˜ç›®æè¿°

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums`ï¼Œè¯·ä½ æ‰¾å‡ºæ•°ç»„ä¸­ä¹˜ç§¯æœ€å¤§çš„éç©ºè¿ç»­å­æ•°ç»„ï¼ˆè¯¥å­æ•°ç»„ä¸­è‡³å°‘åŒ…å«ä¸€ä¸ªæ•°å­—ï¼‰ï¼Œå¹¶è¿”å›è¯¥å­æ•°ç»„æ‰€å¯¹åº”çš„ä¹˜ç§¯ã€‚

æµ‹è¯•ç”¨ä¾‹çš„ç­”æ¡ˆæ˜¯ä¸€ä¸ª **32-ä½** æ•´æ•°ã€‚

å­æ•°ç»„ æ˜¯æ•°ç»„çš„è¿ç»­å­åºåˆ—ã€‚

______________________________________________________________________

# ç¤ºä¾‹è¯´æ˜

âœ… **ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥: nums = [2,3,-2,4]
è¾“å‡º: 6
è§£é‡Š: å­æ•°ç»„ [2,3] æœ‰æœ€å¤§ä¹˜ç§¯ 6ã€‚
```

âœ… **ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥: nums = [-2,0,-1]
è¾“å‡º: 0
è§£é‡Š: ç»“æœä¸èƒ½ä¸º 2, å› ä¸º [-2,-1] ä¸æ˜¯å­æ•°ç»„ã€‚
```

âœ… **ç¤ºä¾‹ 3ï¼š**

```
è¾“å…¥: nums = [-2,3,-4]
è¾“å‡º: 24
è§£é‡Š: å­æ•°ç»„ [-2,3,-4] çš„ä¹˜ç§¯ä¸º (-2)Ã—3Ã—(-4) = 24ã€‚
```

______________________________________________________________________

# è§£é¢˜æ€è·¯

ğŸ“Œ **æ ¸å¿ƒéš¾ç‚¹**ï¼š\
ç”±äºæ•°ç»„ä¸­å¯èƒ½åŒ…å«è´Ÿæ•°ï¼Œè´Ÿè´Ÿå¾—æ­£ï¼Œå› æ­¤å½“å‰æœ€å°çš„è´Ÿæ•°ä¹˜ç§¯åœ¨é‡åˆ°å¦ä¸€ä¸ªè´Ÿæ•°æ—¶å¯èƒ½å˜æˆæœ€å¤§çš„æ­£æ•°ä¹˜ç§¯ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åªç»´æŠ¤æœ€å¤§å€¼ï¼Œè¿˜è¦åŒæ—¶ç»´æŠ¤æœ€å°å€¼ã€‚

## æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’ï¼ˆä¸€æ¬¡éå†ï¼Œç»´æŠ¤æœ€å¤§æœ€å°å€¼ï¼‰âœ…ã€æ¨èã€‘

### æ€è·¯æ­¥éª¤ï¼š

1. **çŠ¶æ€å®šä¹‰**ï¼š

   - `maxF[i]` è¡¨ç¤ºä»¥ç¬¬ `i` ä¸ªå…ƒç´ ç»“å°¾çš„å­æ•°ç»„çš„æœ€å¤§ä¹˜ç§¯ã€‚
   - `minF[i]` è¡¨ç¤ºä»¥ç¬¬ `i` ä¸ªå…ƒç´ ç»“å°¾çš„å­æ•°ç»„çš„æœ€å°ä¹˜ç§¯ã€‚

1. **çŠ¶æ€è½¬ç§»**ï¼š

   - å½“å‰å…ƒç´ ä¸º `nums[i]`ã€‚
   - å¦‚æœ `nums[i] > 0`ï¼š
     - `maxF[i] = max(nums[i], maxF[i-1] * nums[i])`
     - `minF[i] = min(nums[i], minF[i-1] * nums[i])`
   - å¦‚æœ `nums[i] < 0`ï¼š
     - `maxF[i] = max(nums[i], minF[i-1] * nums[i])`ï¼ˆå› ä¸ºè´Ÿæ•° Ã— æœ€å°è´Ÿæ•° = æœ€å¤§æ­£æ•°ï¼‰
     - `minF[i] = min(nums[i], maxF[i-1] * nums[i])`
   - å¦‚æœ `nums[i] == 0`ï¼š
     - `maxF[i] = minF[i] = 0`

   ğŸ’¡ **ç»Ÿä¸€å†™æ³•**ï¼ˆæ— éœ€åˆ¤æ–­ç¬¦å·ï¼‰ï¼š

   ```
   maxF = max(nums[i], maxF_prev * nums[i], minF_prev * nums[i])
   minF = min(nums[i], maxF_prev * nums[i], minF_prev * nums[i])
   ```

1. **åˆå§‹åŒ–**ï¼š

   - `maxF = minF = nums[0]`
   - `result = nums[0]`

1. **éå†æ›´æ–°**ï¼š

   - ä» `i = 1` å¼€å§‹ï¼Œä¾æ¬¡æ›´æ–° `maxF`ã€`minF`ï¼Œå¹¶æ›´æ–°å…¨å±€æœ€å¤§å€¼ `result`ã€‚

1. **ç©ºé—´ä¼˜åŒ–**ï¼š

   - ç”±äºåªä¾èµ–å‰ä¸€ä¸ªçŠ¶æ€ï¼Œå¯ç”¨ä¸¤ä¸ªå˜é‡ä»£æ›¿æ•°ç»„ï¼Œç©ºé—´å¤æ‚åº¦ O(1)ã€‚

## æ–¹æ³•äºŒï¼šæš´åŠ›æšä¸¾ âŒï¼ˆä¸æ¨èï¼‰

- æšä¸¾æ‰€æœ‰å­æ•°ç»„ï¼Œè®¡ç®—ä¹˜ç§¯ï¼Œè®°å½•æœ€å¤§å€¼ã€‚
- æ—¶é—´å¤æ‚åº¦ O(nÂ²)ï¼Œå¯¹äº n=10âµ ä¼šè¶…æ—¶ï¼ˆæœ¬é¢˜ n è¾ƒå°ä½†ä¹Ÿä¸é«˜æ•ˆï¼‰ã€‚

## æ–¹æ³•ä¸‰ï¼šåˆ†æ²»æ³•ï¼ˆå¯é€‰ï¼Œä½†å¤æ‚ï¼‰ğŸ’¡

- å°†æ•°ç»„æŒ‰ 0 åˆ†å‰²æˆå¤šä¸ªä¸å« 0 çš„æ®µã€‚
- å¯¹æ¯æ®µè®¡ç®—æœ€å¤§ä¹˜ç§¯ï¼ˆè€ƒè™‘è´Ÿæ•°ä¸ªæ•°å¥‡å¶æ€§ï¼‰ã€‚
- æ¯”è¾ƒå„æ®µæœ€å¤§å€¼å’Œ 0ï¼ˆå¦‚æœå­˜åœ¨ 0ï¼‰ã€‚
- å®ç°å¤æ‚ï¼Œä¸å¦‚æ–¹æ³•ä¸€ç®€æ´ã€‚

______________________________________________________________________

# ä»£ç å®ç°

<div class="code-tabs">

```java:Java
class Solution {
    public int maxProduct(int[] nums) {
        if (nums == null || nums.length == 0) return 0;
        
        int maxF = nums[0];
        int minF = nums[0];
        int result = nums[0];
        
        for (int i = 1; i < nums.length; i++) {
            int num = nums[i];
            // ä¿å­˜ä¸Šä¸€è½®çš„ maxFï¼Œå› ä¸º minF æ›´æ–°ä¼šç”¨åˆ°å®ƒ
            int tempMax = maxF;
            
            maxF = Math.max(num, Math.max(maxF * num, minF * num));
            minF = Math.min(num, Math.min(tempMax * num, minF * num));
            
            result = Math.max(result, maxF);
        }
        
        return result;
    }
}
```

```go:Go
func maxProduct(nums []int) int {
    if len(nums) == 0 {
        return 0
    }
    
    maxF := nums[0]
    minF := nums[0]
    result := nums[0]
    
    for i := 1; i < len(nums); i++ {
        num := nums[i]
        tempMax := maxF
        
        maxF = max(num, max(maxF*num, minF*num))
        minF = min(num, min(tempMax*num, minF*num))
        
        result = max(result, maxF)
    }
    
    return result
}

func max(a, b int) int {
    if a > b {
        return a
    }
    return b
}

func min(a, b int) int {
    if a < b {
        return a
    }
    return b
}
```

</div>

______________________________________________________________________

# ç¤ºä¾‹æ¼”ç¤º

ä»¥ `nums = [-2, 3, -4]` ä¸ºä¾‹ï¼š

| i | nums[i] | maxFï¼ˆæ›´æ–°å‰ï¼‰ | minFï¼ˆæ›´æ–°å‰ï¼‰ | æ–° maxF | æ–° minF | result |
|---|--------|----------------|----------------|---------|---------|--------|
| 0 | -2 | - | - | -2 | -2 | -2 |
| 1 | 3 | -2 | -2 | max(3, -6, -6)=3 | min(3, -6, -6)=-6 | max(-2,3)=3 |
| 2 | -4 | 3 | -6 | max(-4, -12, 24)=24 | min(-4, -12, 24)=-12 | max(3,24)=24 |

âœ… æœ€ç»ˆç»“æœï¼š24

______________________________________________________________________

# ç­”æ¡ˆæœ‰æ•ˆæ€§è¯æ˜

ğŸ“Œ **å½’çº³æ³•è¯æ˜**ï¼š

- **åŸºç¡€æƒ…å†µ**ï¼š`i=0` æ—¶ï¼Œ`maxF = minF = nums[0]`ï¼Œæ˜¾ç„¶æ­£ç¡®ã€‚
- **å½’çº³å‡è®¾**ï¼šå‡è®¾å¯¹ `i-1`ï¼Œ`maxF` å’Œ `minF` æ­£ç¡®è¡¨ç¤ºä»¥ `i-1` ç»“å°¾çš„æœ€å¤§/æœ€å°ä¹˜ç§¯ã€‚
- **å½’çº³æ­¥éª¤**ï¼š
  - å¯¹äº `i`ï¼Œå­æ•°ç»„å¿…é¡»åŒ…å« `nums[i]`ã€‚
  - å¯èƒ½çš„ä¹˜ç§¯æ¥æºï¼š
    1. ä»… `nums[i]`
    1. `maxF_prev * nums[i]`
    1. `minF_prev * nums[i]`
  - å–ä¸‰è€…æœ€å¤§å³ä¸ºæ–°çš„ `maxF`ï¼Œæœ€å°å³ä¸º `minF`ã€‚
  - å…¨å±€æœ€å¤§å€¼åœ¨æ¯ä¸€æ­¥æ›´æ–°ï¼Œæœ€ç»ˆå¿…åŒ…å«æœ€ä¼˜è§£ã€‚

âœ… å› æ­¤ç®—æ³•æ­£ç¡®ã€‚

______________________________________________________________________

# å¤æ‚åº¦åˆ†æ

| é¡¹ç›® | å¤æ‚åº¦ |
|------|--------|
| â±ï¸ æ—¶é—´å¤æ‚åº¦ | O(n) â€”â€” ä»…éœ€ä¸€æ¬¡éå† |
| ğŸ§  ç©ºé—´å¤æ‚åº¦ | O(1) â€”â€” ä»…ç”¨å¸¸æ•°ä¸ªå˜é‡ |

______________________________________________________________________

# é—®é¢˜æ€»ç»“

âœ… **å…³é”®æ´å¯Ÿ**ï¼š

> è´Ÿæ•°çš„å­˜åœ¨ä½¿å¾—â€œæœ€å°å€¼â€å¯èƒ½åœ¨æœªæ¥å˜æˆâ€œæœ€å¤§å€¼â€ï¼Œå› æ­¤å¿…é¡»åŒæ—¶è¿½è¸ªæœ€å¤§å’Œæœ€å°ä¹˜ç§¯ã€‚

âœ… **æŠ€å·§æ€»ç»“**ï¼š

- åŠ¨æ€è§„åˆ’çŠ¶æ€è®¾è®¡è¦å…¨é¢ï¼ˆæœ€å¤§ + æœ€å°ï¼‰ã€‚
- åˆ©ç”¨ä¸´æ—¶å˜é‡é¿å…çŠ¶æ€è¦†ç›–é”™è¯¯ã€‚
- æ— éœ€åˆ¤æ–­æ­£è´Ÿï¼Œç›´æ¥å–ä¸‰è€…æå€¼å³å¯ç»Ÿä¸€å¤„ç†ã€‚

âœ… **é€‚ç”¨åœºæ™¯**ï¼š\
ç±»ä¼¼â€œæœ€å¤§å­æ•°ç»„å’Œâ€ä½†æ¶‰åŠä¹˜æ³•ä¸”å«è´Ÿæ•°çš„é—®é¢˜ï¼Œå‡å¯é‡‡ç”¨æ­¤åŒçŠ¶æ€ DP æ€è·¯ã€‚

ğŸ’¡ **å»¶ä¼¸æ€è€ƒ**ï¼š\
è‹¥é¢˜ç›®è¦æ±‚è¿”å›å­æ•°ç»„æœ¬èº«ï¼ˆè€Œä¸ä»…æ˜¯ä¹˜ç§¯ï¼‰ï¼Œå¯åœ¨æ›´æ–° `maxF` æ—¶è®°å½•èµ·æ­¢ä½ç½®ï¼Œé€»è¾‘ç¨å¤æ‚ä½†å¯è¡Œã€‚
