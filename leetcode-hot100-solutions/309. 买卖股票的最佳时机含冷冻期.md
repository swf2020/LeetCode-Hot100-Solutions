#  é—®é¢˜ç®€ä»‹

[LeetCode 309. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«å†·å†»æœŸ](https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-with-cooldown?envType=problem-list-v2&envId=2cktkvj)

## é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `prices`ï¼Œå…¶ä¸­ç¬¬ `i` ä¸ªå…ƒç´ ä»£è¡¨äº†ç¬¬ `i` å¤©çš„è‚¡ç¥¨ä»·æ ¼ã€‚

ä½ å¯ä»¥åœ¨ä»¥ä¸‹é™åˆ¶æ¡ä»¶ä¸‹å®Œæˆå°½å¯èƒ½å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰ï¼š

- ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚
- å–å‡ºè‚¡ç¥¨åï¼Œä½ æ— æ³•åœ¨ç¬¬äºŒå¤©ä¹°å…¥è‚¡ç¥¨ï¼ˆå³å­˜åœ¨ 1 å¤©çš„å†·å†»æœŸï¼‰ã€‚

**ç›®æ ‡**ï¼šè®¡ç®—ä½ èƒ½è·å¾—çš„æœ€å¤§åˆ©æ¶¦ã€‚

______________________________________________________________________

# ğŸ“Œ ç¤ºä¾‹è¯´æ˜

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥: prices = [1,2,3,0,2]
è¾“å‡º: 3
è§£é‡Š: å¯¹åº”çš„äº¤æ˜“çŠ¶æ€ä¸º: [ä¹°å…¥, å–å‡º, å†·å†»æœŸ, ä¹°å…¥, å–å‡º]
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥: prices = [1]
è¾“å‡º: 0
```

______________________________________________________________________

# ğŸ’¡ è§£é¢˜æ€è·¯

æœ¬é¢˜æ˜¯ç»å…¸çš„ã€Œè‚¡ç¥¨ä¹°å–ã€ç³»åˆ—é—®é¢˜ä¹‹ä¸€ï¼ŒåŠ å…¥äº†ã€Œå†·å†»æœŸã€è¿™ä¸€æ–°çº¦æŸã€‚æ ¸å¿ƒåœ¨äº **çŠ¶æ€æœºå»ºæ¨¡** æˆ– **åŠ¨æ€è§„åˆ’**ã€‚

## æ–¹æ³•ä¸€ï¼šçŠ¶æ€æœºåŠ¨æ€è§„åˆ’ï¼ˆæ¨èï¼‰

### æ­¥éª¤ 1ï¼šå®šä¹‰çŠ¶æ€

æ¯å¤©ç»“æŸæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½å¤„äºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼š

- **`hold`**ï¼šæŒæœ‰è‚¡ç¥¨ï¼ˆä»Šå¤©ä¹°å…¥æˆ–ä¹‹å‰ä¹°å…¥æœªå–å‡ºï¼‰
- **`sold`**ï¼šä»Šå¤©åˆšå–å‡ºè‚¡ç¥¨ï¼ˆæ˜å¤©è¿›å…¥å†·å†»æœŸï¼‰
- **`rest`**ï¼šä¸æŒæœ‰è‚¡ç¥¨ï¼Œä¸”ä¸åœ¨å†·å†»æœŸï¼ˆå¯ä»¥ä¹°å…¥ï¼‰

> æ³¨æ„ï¼š`rest` åŒ…æ‹¬ä¸¤ç§æƒ…å†µï¼šä»æœªä¹°è¿‡ï¼Œæˆ–å†·å†»æœŸå·²ç»“æŸã€‚

### æ­¥éª¤ 2ï¼šçŠ¶æ€è½¬ç§»æ–¹ç¨‹

- `hold[i] = max(hold[i-1], rest[i-1] - prices[i])`\
  â†’ è¦ä¹ˆç»§ç»­æŒæœ‰ï¼Œè¦ä¹ˆä» `rest` çŠ¶æ€ä¹°å…¥

- `sold[i] = hold[i-1] + prices[i]`\
  â†’ åªèƒ½ä»æŒæœ‰çŠ¶æ€å–å‡º

- `rest[i] = max(rest[i-1], sold[i-1])`\
  â†’ è¦ä¹ˆç»§ç»­ä¿æŒç©ºä»“ï¼Œè¦ä¹ˆä»æ˜¨å¤©çš„ `sold`ï¼ˆå†·å†»æœŸç»“æŸï¼‰è½¬æ¥

### æ­¥éª¤ 3ï¼šåˆå§‹åŒ–

- ç¬¬ 0 å¤©ï¼š
  - `hold = -prices[0]`ï¼ˆä¹°å…¥ï¼‰
  - `sold = 0`ï¼ˆæ— æ³•å–å‡ºï¼‰
  - `rest = 0`ï¼ˆä¸æ“ä½œï¼‰

### æ­¥éª¤ 4ï¼šæœ€ç»ˆç­”æ¡ˆ

æœ€åä¸€å¤©ï¼Œæœ€å¤§åˆ©æ¶¦ä¸º `max(sold, rest)`ï¼ˆä¸å¯èƒ½æŒæœ‰è‚¡ç¥¨ï¼Œå› ä¸ºæŒæœ‰ä¸å¦‚å–å‡ºï¼‰

______________________________________________________________________

## æ–¹æ³•äºŒï¼šç©ºé—´ä¼˜åŒ–ï¼ˆæ»šåŠ¨å˜é‡ï¼‰

ç”±äºæ¯å¤©åªä¾èµ–å‰ä¸€å¤©çš„çŠ¶æ€ï¼Œå¯ç”¨ä¸‰ä¸ªå˜é‡ä»£æ›¿æ•°ç»„ï¼Œå°†ç©ºé—´å¤æ‚åº¦é™è‡³ O(1)ã€‚

______________________________________________________________________

## æ–¹æ³•ä¸‰ï¼šå¦ä¸€ç§çŠ¶æ€å®šä¹‰ï¼ˆå¯é€‰ï¼‰

ä¹Ÿå¯ä»¥å®šä¹‰ `dp[i][0/1]` è¡¨ç¤ºç¬¬ i å¤©æ˜¯å¦æŒæœ‰è‚¡ç¥¨ï¼Œä½†éœ€é¢å¤–å¤„ç†å†·å†»æœŸé€»è¾‘ï¼ˆå¦‚ `dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])`ï¼Œè€Œ `dp[i][1] = max(dp[i-1][1], dp[i-2][0] - prices[i])`ï¼‰ï¼Œå› ä¸ºä¹°å…¥åªèƒ½åœ¨éå†·å†»æœŸï¼Œå³è‡³å°‘ä¸¤å¤©å‰å–å‡ºã€‚

> è¿™ç§æ–¹æ³•ä¹Ÿå¯è¡Œï¼Œä½†çŠ¶æ€æœºæ›´æ¸…æ™°ã€‚

______________________________________________________________________

# ğŸ’» ä»£ç å®ç°

<div class="code-tabs">

```java:Java
class Solution {
    public int maxProfit(int[] prices) {
        if (prices == null || prices.length == 0) return 0;
        
        int hold = -prices[0]; // æŒæœ‰è‚¡ç¥¨
        int sold = 0;          // ä»Šå¤©å–å‡º
        int rest = 0;          // ç©ºä»“ä¸”éå†·å†»
        
        for (int i = 1; i < prices.length; i++) {
            int prevHold = hold;
            int prevSold = sold;
            int prevRest = rest;
            
            hold = Math.max(prevHold, prevRest - prices[i]);
            sold = prevHold + prices[i];
            rest = Math.max(prevRest, prevSold);
        }
        
        return Math.max(sold, rest);
    }
}
```

```go:Go
func maxProfit(prices []int) int {
    if len(prices) == 0 {
        return 0
    }
    
    hold := -prices[0] // æŒæœ‰è‚¡ç¥¨
    sold := 0          // ä»Šå¤©å–å‡º
    rest := 0          // ç©ºä»“ä¸”éå†·å†»
    
    for i := 1; i < len(prices); i++ {
        prevHold, prevSold, prevRest := hold, sold, rest
        
        hold = max(prevHold, prevRest - prices[i])
        sold = prevHold + prices[i]
        rest = max(prevRest, prevSold)
    }
    
    return max(sold, rest)
}

func max(a, b int) int {
    if a > b {
        return a
    }
    return b
}
```

</div>

______________________________________________________________________

# ğŸ§ª ç¤ºä¾‹æ¼”ç¤º

ä»¥ `prices = [1,2,3,0,2]` ä¸ºä¾‹ï¼š

| Day | Price | hold | sold | rest |
|-----|-------|------------|------------|------------|
| 0 | 1 | -1 | 0 | 0 |
| 1 | 2 | max(-1, 0-2)=-1 | -1+2=1 | max(0,0)=0 |
| 2 | 3 | max(-1,0-3)=-1 | -1+3=2 | max(0,1)=1 |
| 3 | 0 | max(-1,1-0)=1 | -1+0=-1 | max(1,2)=2 |
| 4 | 2 | max(1,2-2)=1 | 1+2=3 | max(2,-1)=2 |

æœ€ç»ˆ `max(sold=3, rest=2) = 3` âœ…

______________________________________________________________________

# âœ… ç­”æ¡ˆæœ‰æ•ˆæ€§è¯æ˜

- **çŠ¶æ€è¦†ç›–å®Œæ•´**ï¼šä¸‰ç§çŠ¶æ€äº’æ–¥ä¸”ç©·å°½æ‰€æœ‰å¯èƒ½ã€‚
- **è½¬ç§»æ­£ç¡®**ï¼š
  - ä¹°å…¥åªèƒ½ä» `rest`ï¼ˆéå†·å†»ï¼‰å‡ºå‘ï¼›
  - å–å‡ºåå¿…è¿›å…¥ `sold`ï¼Œæ¬¡æ—¥è‡ªåŠ¨å˜ä¸º `rest` çš„å€™é€‰ï¼›
  - `rest` å¯ç”±è‡ªèº«å»¶ç»­æˆ–ä» `sold` è½¬å…¥ï¼ˆå†·å†»æœŸç»“æŸï¼‰ã€‚
- **è¾¹ç•Œå¤„ç†æ­£ç¡®**ï¼šç¬¬ 0 å¤©åˆå§‹åŒ–åˆç†ã€‚
- **æœ€ä¼˜å­ç»“æ„**ï¼šæ¯ä¸€å¤©çš„æœ€ä¼˜è§£ç”±å‰ä¸€å¤©çš„æœ€ä¼˜è§£æ¨å¯¼è€Œæ¥ã€‚

å› æ­¤ï¼Œç®—æ³•æ­£ç¡®ã€‚

______________________________________________________________________

# ğŸ“Š å¤æ‚åº¦åˆ†æ

| é¡¹ç›® | å¤æ‚åº¦ |
|--------------|------------|
| æ—¶é—´å¤æ‚åº¦ | O(n) |
| ç©ºé—´å¤æ‚åº¦ | O(1) |

> ä»…ä½¿ç”¨å¸¸æ•°ä¸ªå˜é‡ï¼Œéå†ä¸€æ¬¡æ•°ç»„ã€‚

______________________________________________________________________

# ğŸ“Œ é—®é¢˜æ€»ç»“

- **å…³é”®ç‚¹**ï¼šå¼•å…¥ã€Œå†·å†»æœŸã€åï¼Œä¸èƒ½ç®€å•ç”¨ `buy/sell` ä¸¤çŠ¶æ€ï¼Œéœ€å¢åŠ  `rest` çŠ¶æ€åŒºåˆ†æ˜¯å¦å¯ä¹°å…¥ã€‚
- **æŠ€å·§**ï¼šçŠ¶æ€æœºå»ºæ¨¡æ˜¯å¤„ç†å¸¦çº¦æŸ DP é—®é¢˜çš„å¼ºå¤§å·¥å…·ã€‚
- **æ‰©å±•**ï¼šç±»ä¼¼é—®é¢˜å¦‚ã€Œå«æ‰‹ç»­è´¹ã€ã€Œæœ€å¤š k æ¬¡äº¤æ˜“ã€ç­‰ï¼Œå‡å¯é€šè¿‡æ‰©å±•çŠ¶æ€è§£å†³ã€‚
- **è®°å¿†å£è¯€**ï¼š
  > â€œæŒã€å–ã€æ­‡ï¼Œä¸‰æ€æµè½¬ï¼›\
  > ä¹°ä»æ­‡èµ·ï¼Œå–å…¥æŒä¸­ï¼›\
  > å†·å†»ä¸€æ—¥ï¼Œæ­‡æ‰¿å–ç»ˆã€‚â€
