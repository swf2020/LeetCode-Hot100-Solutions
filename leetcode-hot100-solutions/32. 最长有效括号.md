### é—®é¢˜ç®€ä»‹

ğŸ”— [LeetCode 32. æœ€é•¿æœ‰æ•ˆæ‹¬å·](https://leetcode.cn/problems/longest-valid-parentheses?envType=problem-list-v2&envId=2cktkvj)

#### é¢˜ç›®æè¿°

ç»™ä½ ä¸€ä¸ªåªåŒ…å« `'('` å’Œ `')'` çš„å­—ç¬¦ä¸²ï¼Œæ‰¾å‡º**æœ€é•¿æœ‰æ•ˆ**ï¼ˆæ ¼å¼æ­£ç¡®ä¸”è¿ç»­ï¼‰æ‹¬å·å­ä¸²çš„é•¿åº¦ã€‚

______________________________________________________________________

### ç¤ºä¾‹è¯´æ˜

âœ… **ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šs = "(()"
è¾“å‡ºï¼š2
è§£é‡Šï¼šæœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²æ˜¯ "()"
```

âœ… **ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šs = ")()())"
è¾“å‡ºï¼š4
è§£é‡Šï¼šæœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²æ˜¯ "()()"
```

âœ… **ç¤ºä¾‹ 3ï¼š**

```
è¾“å…¥ï¼šs = ""
è¾“å‡ºï¼š0
```

______________________________________________________________________

### è§£é¢˜æ€è·¯

ğŸ“Œ æœ¬é¢˜è¦æ±‚æ‰¾å‡º**æœ€é•¿è¿ç»­æœ‰æ•ˆæ‹¬å·å­ä¸²**çš„é•¿åº¦ã€‚æœ‰æ•ˆæ‹¬å·å³åˆæ³•çš„æ‹¬å·åŒ¹é…åºåˆ—ã€‚

æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä»¥ä¸‹å‡ ç§ä¸»æµæ–¹æ³•ï¼š

______________________________________________________________________

#### ğŸ’¡ æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰

**æ ¸å¿ƒæ€æƒ³ï¼š**\
å®šä¹‰ `dp[i]` è¡¨ç¤ºä»¥ `s[i]` ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²é•¿åº¦ã€‚

- å¦‚æœ `s[i] == '('`ï¼Œåˆ™ `dp[i] = 0`ï¼ˆä¸å¯èƒ½ä»¥å·¦æ‹¬å·ç»“å°¾å½¢æˆæœ‰æ•ˆæ‹¬å·ï¼‰ã€‚
- å¦‚æœ `s[i] == ')'`ï¼š
  - æƒ…å†µ1ï¼š`s[i-1] == '('` â†’ `dp[i] = dp[i-2] + 2`
  - æƒ…å†µ2ï¼š`s[i-1] == ')'` ä¸” `s[i - dp[i-1] - 1] == '('` â†’\
    `dp[i] = dp[i-1] + 2 + dp[i - dp[i-1] - 2]`

> æ³¨æ„è¾¹ç•Œæ£€æŸ¥ï¼

______________________________________________________________________

#### ğŸ’¡ æ–¹æ³•äºŒï¼šæ ˆï¼ˆStackï¼‰

**æ ¸å¿ƒæ€æƒ³ï¼š**\
ç”¨æ ˆå­˜å‚¨ä¸‹æ ‡ï¼Œåˆå§‹å‹å…¥ `-1` ä½œä¸ºåŸºå‡†ã€‚

- é‡åˆ° `'('`ï¼šå‹å…¥å½“å‰ä¸‹æ ‡ã€‚
- é‡åˆ° `')'`ï¼š
  - å¼¹å‡ºæ ˆé¡¶ã€‚
  - è‹¥æ ˆä¸ºç©ºï¼šè¯´æ˜å½“å‰ `')'` æ— æ³•åŒ¹é…ï¼Œå‹å…¥å½“å‰ä¸‹æ ‡ä½œä¸ºæ–°åŸºå‡†ã€‚
  - å¦åˆ™ï¼šå½“å‰æœ‰æ•ˆé•¿åº¦ = `i - stack.peek()`ï¼Œæ›´æ–°æœ€å¤§å€¼ã€‚

> æ ˆä¸­å§‹ç»ˆä¿å­˜â€œæœ€åä¸€ä¸ªæœªåŒ¹é…çš„å³æ‹¬å·ä½ç½®â€æˆ–èµ·å§‹ç‚¹ã€‚

______________________________________________________________________

#### ğŸ’¡ æ–¹æ³•ä¸‰ï¼šåŒæŒ‡é’ˆï¼ˆå·¦å³æ‰«æï¼‰

**æ ¸å¿ƒæ€æƒ³ï¼š**\
ä»å·¦åˆ°å³æ‰«æï¼Œè®°å½• `left` å’Œ `right` æ‹¬å·æ•°é‡ï¼š

- å½“ `left == right`ï¼šæ›´æ–°æœ€å¤§é•¿åº¦ä¸º `2 * right`
- å½“ `right > left`ï¼šé‡ç½®è®¡æ•°å™¨ï¼ˆè¯´æ˜å³æ‹¬å·å¤šï¼Œéæ³•ï¼‰

ä½†ä»…ä»å·¦åˆ°å³ä¼šæ¼æ‰å¦‚ `"(()"` è¿™ç§æƒ…å†µï¼ˆå·¦å¤šå³å°‘ï¼‰ï¼Œæ‰€ä»¥è¿˜éœ€**ä»å³åˆ°å·¦å†æ‰«ä¸€æ¬¡**ï¼Œæ­¤æ—¶å½“ `left > right` æ—¶é‡ç½®ã€‚

> ä¸¤æ¬¡æ‰«æè¦†ç›–æ‰€æœ‰æƒ…å†µã€‚

______________________________________________________________________

### ä»£ç å®ç°

```java
// Java å®ç°

class Solution {
    // æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’
    public int longestValidParentheses(String s) {
        if (s == null || s.length() < 2) return 0;
        int n = s.length();
        int[] dp = new int[n];
        int maxLen = 0;

        for (int i = 1; i < n; i++) {
            if (s.charAt(i) == ')') {
                if (s.charAt(i - 1) == '(') {
                    dp[i] = (i >= 2 ? dp[i - 2] : 0) + 2;
                } else if (dp[i - 1] > 0) {
                    int matchIndex = i - dp[i - 1] - 1;
                    if (matchIndex >= 0 && s.charAt(matchIndex) == '(') {
                        dp[i] = dp[i - 1] + 2 + (matchIndex > 0 ? dp[matchIndex - 1] : 0);
                    }
                }
                maxLen = Math.max(maxLen, dp[i]);
            }
        }
        return maxLen;
    }

    // æ–¹æ³•äºŒï¼šæ ˆ
    public int longestValidParenthesesStack(String s) {
        Stack<Integer> stack = new Stack<>();
        stack.push(-1); // åŸºå‡†
        int maxLen = 0;

        for (int i = 0; i < s.length(); i++) {
            if (s.charAt(i) == '(') {
                stack.push(i);
            } else {
                stack.pop();
                if (stack.isEmpty()) {
                    stack.push(i); // æ–°çš„æ— æ•ˆèµ·ç‚¹
                } else {
                    maxLen = Math.max(maxLen, i - stack.peek());
                }
            }
        }
        return maxLen;
    }

    // æ–¹æ³•ä¸‰ï¼šåŒæŒ‡é’ˆ
    public int longestValidParenthesesTwoPass(String s) {
        int left = 0, right = 0, maxLen = 0;

        // Left to Right
        for (int i = 0; i < s.length(); i++) {
            if (s.charAt(i) == '(') left++;
            else right++;
            if (left == right) {
                maxLen = Math.max(maxLen, 2 * right);
            } else if (right > left) {
                left = right = 0;
            }
        }

        left = right = 0;
        // Right to Left
        for (int i = s.length() - 1; i >= 0; i--) {
            if (s.charAt(i) == '(') left++;
            else right++;
            if (left == right) {
                maxLen = Math.max(maxLen, 2 * left);
            } else if (left > right) {
                left = right = 0;
            }
        }

        return maxLen;
    }
}
````

```go
// Go å®ç°

func longestValidParentheses(s string) int {
    // æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’
    if len(s) < 2 {
        return 0
    }
    n := len(s)
    dp := make([]int, n)
    maxLen := 0

    for i := 1; i < n; i++ {
        if s[i] == ')' {
            if s[i-1] == '(' {
                if i >= 2 {
                    dp[i] = dp[i-2] + 2
                } else {
                    dp[i] = 2
                }
            } else if dp[i-1] > 0 {
                matchIndex := i - dp[i-1] - 1
                if matchIndex >= 0 && s[matchIndex] == '(' {
                    dp[i] = dp[i-1] + 2
                    if matchIndex > 0 {
                        dp[i] += dp[matchIndex-1]
                    }
                }
            }
            if dp[i] > maxLen {
                maxLen = dp[i]
            }
        }
    }
    return maxLen
}

// æ–¹æ³•äºŒï¼šæ ˆ
func longestValidParenthesesStack(s string) int {
    stack := []int{-1} // åŸºå‡†
    maxLen := 0

    for i, ch := range s {
        if ch == '(' {
            stack = append(stack, i)
        } else {
            stack = stack[:len(stack)-1] // pop
            if len(stack) == 0 {
                stack = append(stack, i) // æ–°èµ·ç‚¹
            } else {
                if i-stack[len(stack)-1] > maxLen {
                    maxLen = i - stack[len(stack)-1]
                }
            }
        }
    }
    return maxLen
}

// æ–¹æ³•ä¸‰ï¼šåŒæŒ‡é’ˆ
func longestValidParenthesesTwoPass(s string) int {
    left, right, maxLen := 0, 0, 0

    // Left to Right
    for i := 0; i < len(s); i++ {
        if s[i] == '(' {
            left++
        } else {
            right++
        }
        if left == right {
            if 2*right > maxLen {
                maxLen = 2 * right
            }
        } else if right > left {
            left, right = 0, 0
        }
    }

    left, right = 0, 0
    // Right to Left
    for i := len(s) - 1; i >= 0; i-- {
        if s[i] == '(' {
            left++
        } else {
            right++
        }
        if left == right {
            if 2*left > maxLen {
                maxLen = 2 * left
            }
        } else if left > right {
            left, right = 0, 0
        }
    }

    return maxLen
}
```
---
### ç¤ºä¾‹æ¼”ç¤º

ä»¥ `s = ")()())"` ä¸ºä¾‹ï¼š

- **DP è¿‡ç¨‹ï¼š**
```

i: 0 1 2 3 4 5
s: ) ( ) ( ) )
dp:0 0 2 0 4 0 â†’ max = 4

```

- **æ ˆè¿‡ç¨‹ï¼š**
```

i=-1: stack=[-1]
i=0: ')' â†’ pop â†’ stack empty â†’ push 0 â†’ stack=[0]
i=1: '(' â†’ push â†’ [0,1]
i=2: ')' â†’ pop â†’ stack=[0] â†’ len=2-0=2
i=3: '(' â†’ push â†’ [0,3]
i=4: ')' â†’ pop â†’ stack=[0] â†’ len=4-0=4 â†’ max=4
i=5: ')' â†’ pop â†’ stack empty â†’ push 5

```

- **åŒæŒ‡é’ˆï¼š**
- å·¦â†’å³ï¼šåœ¨ i=4 æ—¶ left=2, right=2 â†’ len=4
- å³â†’å·¦ï¼šæ— æ›´ä¼˜è§£

âœ… æ‰€æœ‰æ–¹æ³•å‡å¾— `4`

---

### ç­”æ¡ˆæœ‰æ•ˆæ€§è¯æ˜

| æ–¹æ³• | æ­£ç¡®æ€§ä¾æ® |
|------|-----------|
| âœ… DP | çŠ¶æ€è½¬ç§»è¦†ç›–æ‰€æœ‰ä»¥ `)` ç»“å°¾çš„æœ‰æ•ˆå­ä¸²ï¼Œä¸”åˆ©ç”¨å·²æœ‰æœ€ä¼˜è§£æ„å»ºå½“å‰è§£ |
| âœ… æ ˆ | åˆ©ç”¨æ ˆå¤©ç„¶åŒ¹é…ç‰¹æ€§ï¼Œé€šè¿‡ä¸‹æ ‡å·®è®¡ç®—é•¿åº¦ï¼ŒåŸºå‡†ç‚¹ç¡®ä¿è¿ç»­æ€§ |
| âœ… åŒæŒ‡é’ˆ | ä¸¤æ¬¡æ‰«æåˆ†åˆ«å¤„ç†â€œå³å¤šâ€å’Œâ€œå·¦å¤šâ€æƒ…å†µï¼Œæ•°å­¦ä¸Šå®Œå¤‡ |

> æ‰€æœ‰æ–¹æ³•å‡èƒ½å¤„ç†è¾¹ç•Œå¦‚ `""`, `"("`, `")"`, `"(()"`, `")()())"` ç­‰ã€‚

---

### å¤æ‚åº¦åˆ†æ

| æ–¹æ³• | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ |
|------|------------|------------|
| ğŸ’¡ åŠ¨æ€è§„åˆ’ | O(n) | O(n) |
| ğŸ’¡ æ ˆ | O(n) | O(n) |
| ğŸ’¡ åŒæŒ‡é’ˆ | O(n) | **O(1)** âœ…ï¼ˆæœ€ä¼˜ç©ºé—´ï¼‰|

> åŒæŒ‡é’ˆæ³•åœ¨ç©ºé—´ä¸Šæœ€ä¼˜ï¼Œé€‚åˆå†…å­˜æ•æ„Ÿåœºæ™¯ã€‚

---

### é—®é¢˜æ€»ç»“

ğŸ“Œ **å…³é”®æ´å¯Ÿï¼š**
- æœ‰æ•ˆæ‹¬å·å¿…é¡»ä»¥ `')'` ç»“å°¾ã€‚
- è¿ç»­æ€§è¦æ±‚ä¸èƒ½è·³è¿‡å­—ç¬¦ã€‚
- å•å‘æ‰«æä¼šé—æ¼â€œå·¦æ‹¬å·è¿‡å‰©â€æƒ…å†µï¼Œéœ€åŒå‘å¤„ç†ã€‚

âœ… **æ¨èè§£æ³•ï¼š**
- é¢è¯•é¦–é€‰ **æ ˆ**ï¼ˆç›´è§‚ã€æ˜“å†™ã€é€šç”¨æ€§å¼ºï¼‰
- è¿½æ±‚ç©ºé—´æ•ˆç‡ç”¨ **åŒæŒ‡é’ˆ**
- DP é€‚åˆå±•ç¤ºåŠ¨æ€è§„åˆ’æ€ç»´

âŒ **å¸¸è§é”™è¯¯ï¼š**
- å¿˜è®°è¾¹ç•Œæ£€æŸ¥ï¼ˆå¦‚ `i-2 < 0`ï¼‰
- æ ˆæœªåˆå§‹åŒ– `-1`
- åŒæŒ‡é’ˆåªåšå•å‘æ‰«æ
