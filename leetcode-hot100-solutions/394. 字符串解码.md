## é—®é¢˜ç®€ä»‹

[LeetCode 394. å­—ç¬¦ä¸²è§£ç ](https://leetcode.cn/problems/decode-string?envType=problem-list-v2&envId=2cktkvj)

### é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªç»è¿‡ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè¿”å›å®ƒè§£ç åçš„å­—ç¬¦ä¸²ã€‚

ç¼–ç è§„åˆ™ä¸º: `k[encoded_string]`ï¼Œè¡¨ç¤ºå…¶ä¸­æ–¹æ‹¬å·å†…éƒ¨çš„ `encoded_string` æ­£å¥½é‡å¤ k æ¬¡ã€‚æ³¨æ„ k ä¿è¯ä¸ºæ­£æ•´æ•°ã€‚

ä½ å¯ä»¥è®¤ä¸ºè¾“å…¥å­—ç¬¦ä¸²æ€»æ˜¯æœ‰æ•ˆçš„ï¼›è¾“å…¥å­—ç¬¦ä¸²ä¸­æ²¡æœ‰é¢å¤–çš„ç©ºæ ¼ï¼Œä¸”è¾“å…¥çš„æ–¹æ‹¬å·æ€»æ˜¯ç¬¦åˆæ ¼å¼è¦æ±‚çš„ã€‚

æ­¤å¤–ï¼Œä½ å¯ä»¥è®¤ä¸ºåŸå§‹æ•°æ®ä¸åŒ…å«æ•°å­—ï¼Œæ‰€æœ‰çš„æ•°å­—åªè¡¨ç¤ºé‡å¤æ¬¡æ•° k ï¼Œä¾‹å¦‚ä¸ä¼šå‡ºç°åƒ `3a` æˆ– `2[4]` çš„è¾“å…¥ã€‚

______________________________________________________________________

## ç¤ºä¾‹è¯´æ˜

âœ… **ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šs = "3[a]2[bc]"
è¾“å‡ºï¼š"aaabcbc"
```

âœ… **ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šs = "3[a2[c]]"
è¾“å‡ºï¼š"accaccacc"
```

âœ… **ç¤ºä¾‹ 3ï¼š**

```
è¾“å…¥ï¼šs = "2[abc]3[cd]ef"
è¾“å‡ºï¼š"abcabccdcdcdef"
```

âœ… **ç¤ºä¾‹ 4ï¼š**

```
è¾“å…¥ï¼šs = "abc3[cd]xyz"
è¾“å‡ºï¼š"abccdcdcdxyz"
```

______________________________________________________________________

## è§£é¢˜æ€è·¯

### æ–¹æ³•ä¸€ï¼šæ ˆï¼ˆStackï¼‰æ¨¡æ‹Ÿ âœ…

ğŸ“Œ **æ ¸å¿ƒæ€æƒ³**ï¼šä½¿ç”¨ä¸¤ä¸ªæ ˆåˆ†åˆ«å­˜å‚¨æ•°å­—å’Œå­—ç¬¦ä¸²ç‰‡æ®µï¼Œé‡åˆ°å³æ‹¬å·æ—¶è¿›è¡Œè§£ç æ“ä½œã€‚

**æ­¥éª¤è¯¦è§£ï¼š**

1. **åˆå§‹åŒ–**ï¼š

   - `numStack`ï¼šå­˜å‚¨é‡å¤æ¬¡æ•°
   - `strStack`ï¼šå­˜å‚¨å¾…å¤„ç†çš„å­—ç¬¦ä¸²ç‰‡æ®µ
   - `currentNum`ï¼šå½“å‰æ­£åœ¨æ„å»ºçš„æ•°å­—
   - `currentStr`ï¼šå½“å‰æ­£åœ¨æ„å»ºçš„å­—ç¬¦ä¸²

1. **éå†å­—ç¬¦ä¸²**ï¼š

   - **é‡åˆ°æ•°å­—**ï¼šæ›´æ–° `currentNum = currentNum * 10 + (c - '0')`
   - **é‡åˆ° '\['**ï¼š
     - å°† `currentNum` å‹å…¥ `numStack`
     - å°† `currentStr` å‹å…¥ `strStack`
     - é‡ç½® `currentNum = 0`, `currentStr = ""`
   - **é‡åˆ° '\]'**ï¼š
     - å¼¹å‡º `numStack` é¡¶éƒ¨çš„é‡å¤æ¬¡æ•° `repeatTimes`
     - å¼¹å‡º `strStack` é¡¶éƒ¨çš„å‰ç¼€å­—ç¬¦ä¸² `prevStr`
     - å°† `currentStr` é‡å¤ `repeatTimes` æ¬¡ï¼Œæ‹¼æ¥åˆ° `prevStr` å
     - æ›´æ–° `currentStr = prevStr + repeatedCurrentStr`
   - **é‡åˆ°å­—æ¯**ï¼šç›´æ¥è¿½åŠ åˆ° `currentStr`

1. **è¿”å›ç»“æœ**ï¼šæœ€ç»ˆçš„ `currentStr` å³ä¸ºè§£ç ç»“æœ

### æ–¹æ³•äºŒï¼šé€’å½’ï¼ˆDFSï¼‰âœ…

ğŸ“Œ **æ ¸å¿ƒæ€æƒ³**ï¼šå°†æ¯ä¸ª `[` çœ‹ä½œé€’å½’å…¥å£ï¼Œ`]` çœ‹ä½œé€’å½’å‡ºå£ã€‚

**æ­¥éª¤è¯¦è§£ï¼š**

1. ä½¿ç”¨å…¨å±€ç´¢å¼• `index` è·Ÿè¸ªå½“å‰ä½ç½®
1. é‡åˆ°æ•°å­—æ—¶ï¼Œè§£æå®Œæ•´æ•°å­—
1. é‡åˆ° `[` æ—¶ï¼Œé€’å½’å¤„ç†å†…éƒ¨å­—ç¬¦ä¸²
1. é‡åˆ° `]` æ—¶ï¼Œè¿”å›å½“å‰å±‚çš„ç»“æœ
1. é‡åˆ°å­—æ¯æ—¶ï¼Œç›´æ¥æ·»åŠ åˆ°ç»“æœä¸­

### æ–¹æ³•ä¸‰ï¼šåŒæ ˆä¼˜åŒ–ç‰ˆæœ¬ âœ…

ğŸ“Œ **æ ¸å¿ƒæ€æƒ³**ï¼šä¸æ–¹æ³•ä¸€ç±»ä¼¼ï¼Œä½†ä½¿ç”¨æ›´ç®€æ´çš„å®ç°æ–¹å¼ï¼Œé¿å…é‡å¤å­—ç¬¦ä¸²æ‹¼æ¥ã€‚

______________________________________________________________________

## ä»£ç å®ç°

```java
import java.util.*;

public class Solution {
    // æ–¹æ³•ä¸€ï¼šæ ˆæ¨¡æ‹Ÿ
    public String decodeString(String s) {
        Stack<Integer> numStack = new Stack<>();
        Stack<String> strStack = new Stack<>();
        int currentNum = 0;
        StringBuilder currentStr = new StringBuilder();
        
        for (char c : s.toCharArray()) {
            if (Character.isDigit(c)) {
                currentNum = currentNum * 10 + (c - '0');
            } else if (c == '[') {
                numStack.push(currentNum);
                strStack.push(currentStr.toString());
                currentNum = 0;
                currentStr = new StringBuilder();
            } else if (c == ']') {
                int repeatTimes = numStack.pop();
                String prevStr = strStack.pop();
                StringBuilder repeated = new StringBuilder();
                for (int i = 0; i < repeatTimes; i++) {
                    repeated.append(currentStr);
                }
                currentStr = new StringBuilder(prevStr).append(repeated);
            } else {
                currentStr.append(c);
            }
        }
        
        return currentStr.toString();
    }
    
    // æ–¹æ³•äºŒï¼šé€’å½’
    private int index = 0;
    
    public String decodeStringRecursive(String s) {
        index = 0;
        return dfs(s);
    }
    
    private String dfs(String s) {
        StringBuilder result = new StringBuilder();
        
        while (index < s.length()) {
            char c = s.charAt(index);
            
            if (Character.isDigit(c)) {
                // è§£ææ•°å­—
                int num = 0;
                while (index < s.length() && Character.isDigit(s.charAt(index))) {
                    num = num * 10 + (s.charAt(index) - '0');
                    index++;
                }
                
                // è·³è¿‡ '['
                index++;
                
                // é€’å½’è·å–å†…éƒ¨å­—ç¬¦ä¸²
                String inner = dfs(s);
                
                // é‡å¤æ‹¼æ¥
                for (int i = 0; i < num; i++) {
                    result.append(inner);
                }
            } else if (c == ']') {
                // é‡åˆ° ']' è¿”å›å½“å‰å±‚ç»“æœ
                index++;
                return result.toString();
            } else {
                // å­—æ¯ç›´æ¥æ·»åŠ 
                result.append(c);
                index++;
            }
        }
        
        return result.toString();
    }
}
```

```go:Go
package main

import (
	"strconv"
	"strings"
)

// æ–¹æ³•ä¸€ï¼šæ ˆæ¨¡æ‹Ÿ
func decodeString(s string) string {
	numStack := []int{}
	strStack := []string{}
	currentNum := 0
	currentStr := strings.Builder{}
	
	for _, c := range s {
		if c >= '0' && c <= '9' {
			currentNum = currentNum*10 + int(c-'0')
		} else if c == '[' {
			numStack = append(numStack, currentNum)
			strStack = append(strStack, currentStr.String())
			currentNum = 0
			currentStr.Reset()
		} else if c == ']' {
			repeatTimes := numStack[len(numStack)-1]
			numStack = numStack[:len(numStack)-1]
			
			prevStr := strStack[len(strStack)-1]
			strStack = strStack[:len(strStack)-1]
			
			repeated := strings.Repeat(currentStr.String(), repeatTimes)
			currentStr.Reset()
			currentStr.WriteString(prevStr + repeated)
		} else {
			currentStr.WriteRune(c)
		}
	}
	
	return currentStr.String()
}

// æ–¹æ³•äºŒï¼šé€’å½’
var index int

func decodeStringRecursive(s string) string {
	index = 0
	return dfs(s)
}

func dfs(s string) string {
	var result strings.Builder
	
	for index < len(s) {
		c := s[index]
		
		if c >= '0' && c <= '9' {
			// è§£ææ•°å­—
			num := 0
			for index < len(s) && s[index] >= '0' && s[index] <= '9' {
				num = num*10 + int(s[index]-'0')
				index++
			}
			
			// è·³è¿‡ '['
			index++
			
			// é€’å½’è·å–å†…éƒ¨å­—ç¬¦ä¸²
			inner := dfs(s)
			
			// é‡å¤æ‹¼æ¥
			for i := 0; i < num; i++ {
				result.WriteString(inner)
			}
		} else if c == ']' {
			// é‡åˆ° ']' è¿”å›å½“å‰å±‚ç»“æœ
			index++
			return result.String()
		} else {
			// å­—æ¯ç›´æ¥æ·»åŠ 
			result.WriteByte(c)
			index++
		}
	}
	
	return result.String()
}
```


---

## ç¤ºä¾‹æ¼”ç¤º

è®©æˆ‘ä»¬ä»¥ `"3[a2[c]]"` ä¸ºä¾‹æ¼”ç¤ºæ ˆæ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼š

| æ­¥éª¤ | å­—ç¬¦ | currentNum | currentStr | numStack | strStack | è¯´æ˜ |
|------|------|------------|------------|----------|----------|------|
| 1 | '3' | 3 | "" | [] | [] | è¯»å–æ•°å­— |
| 2 | '[' | 0 | "" | [3] | [""] | å‹æ ˆï¼Œé‡ç½® |
| 3 | 'a' | 0 | "a" | [3] | [""] | æ·»åŠ å­—æ¯ |
| 4 | '2' | 2 | "a" | [3] | [""] | è¯»å–æ•°å­— |
| 5 | '[' | 0 | "" | [3,2] | ["", "a"] | å‹æ ˆï¼Œé‡ç½® |
| 6 | 'c' | 0 | "c" | [3,2] | ["", "a"] | æ·»åŠ å­—æ¯ |
| 7 | ']' | 0 | "cc" | [3] | [""] | å¼¹æ ˆï¼Œé‡å¤2æ¬¡ |
| 8 | ']' | 0 | "accaccacc" | [] | [] | å¼¹æ ˆï¼Œé‡å¤3æ¬¡ |

æœ€ç»ˆç»“æœï¼š`"accaccacc"` âœ…

---

## ç­”æ¡ˆæœ‰æ•ˆæ€§è¯æ˜

ğŸ’¡ **æ­£ç¡®æ€§åˆ†æï¼š**

1. **æ‹¬å·åŒ¹é…**ï¼šé¢˜ç›®ä¿è¯è¾“å…¥æœ‰æ•ˆï¼Œæ‰€ä»¥æ¯ä¸ª `[` éƒ½æœ‰å¯¹åº”çš„ `]`
2. **æ•°å­—å¤„ç†**ï¼šé€šè¿‡ `currentNum = currentNum * 10 + digit` æ­£ç¡®å¤„ç†å¤šä½æ•°
3. **åµŒå¥—å¤„ç†**ï¼šæ ˆçš„ LIFO ç‰¹æ€§å¤©ç„¶é€‚åˆå¤„ç†åµŒå¥—ç»“æ„
4. **è¾¹ç•Œæƒ…å†µ**ï¼š
   - çº¯å­—æ¯å­—ç¬¦ä¸²ï¼šç›´æ¥è¿”å›
   - å•å±‚åµŒå¥—ï¼šæ­£å¸¸å¤„ç†
   - å¤šå±‚åµŒå¥—ï¼šé€’å½’/æ ˆæ­£ç¡®å±•å¼€

âŒ **å¸¸è§é”™è¯¯ç‚¹ï¼š**
- å¿˜è®°é‡ç½® `currentNum` å’Œ `currentStr`
- å­—ç¬¦ä¸²æ‹¼æ¥æ•ˆç‡ä½ä¸‹ï¼ˆåº”ä½¿ç”¨ StringBuilder/StringBuilderï¼‰
- æ•°å­—è§£æé”™è¯¯ï¼ˆæœªå¤„ç†å¤šä½æ•°ï¼‰

---

## å¤æ‚åº¦åˆ†æ

| æ–¹æ³• | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | è¯´æ˜ |
|------|------------|------------|------|
| æ ˆæ¨¡æ‹Ÿ | O(n Ã— m) | O(n) | nä¸ºè¾“å…¥é•¿åº¦ï¼Œmä¸ºæœ€å¤§é‡å¤æ¬¡æ•° |
| é€’å½’ | O(n Ã— m) | O(n) | é€’å½’æ·±åº¦æœ€å¤šä¸ºåµŒå¥—å±‚æ•° |

ğŸ“Œ **è¯¦ç»†è¯´æ˜ï¼š**
- **æ—¶é—´å¤æ‚åº¦**ï¼šæœ€åæƒ…å†µä¸‹éœ€è¦é‡å¤æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œå¦‚ `"1000[a]"` éœ€è¦åˆ›å»ºé•¿åº¦ä¸º1000çš„å­—ç¬¦ä¸²
- **ç©ºé—´å¤æ‚åº¦**ï¼šæ ˆçš„ç©ºé—´æ¶ˆè€—ä¸åµŒå¥—æ·±åº¦æˆæ­£æ¯”ï¼Œæœ€åæƒ…å†µä¸‹ä¸º O(n)

---

## é—®é¢˜æ€»ç»“

âœ… **å…³é”®è¦ç‚¹ï¼š**
1. **æ ˆæ˜¯å¤„ç†åµŒå¥—ç»“æ„çš„åˆ©å™¨**ï¼šLIFO ç‰¹æ€§å®Œç¾åŒ¹é…æ‹¬å·åŒ¹é…é—®é¢˜
2. **çŠ¶æ€ç®¡ç†**ï¼šéœ€è¦åŒæ—¶ç»´æŠ¤æ•°å­—çŠ¶æ€å’Œå­—ç¬¦ä¸²çŠ¶æ€
3. **è¾¹ç•Œå¤„ç†**ï¼šæ³¨æ„æ•°å­—é‡ç½®å’Œå­—ç¬¦ä¸²æ‹¼æ¥çš„æ—¶æœº

ğŸ’¡ **æ‰©å±•æ€è€ƒï¼š**
- å¦‚æœå…è®¸è´Ÿæ•°é‡å¤æ¬¡æ•°æ€ä¹ˆåŠï¼Ÿ
- å¦‚æœæ”¯æŒæ›´å¤æ‚çš„è¡¨è¾¾å¼ï¼ˆå¦‚ `2[3[a]b]`ï¼‰å¦‚ä½•å¤„ç†ï¼Ÿ
- å¦‚ä½•ä¼˜åŒ–é‡å¤å­—ç¬¦ä¸²æ‹¼æ¥çš„æ€§èƒ½ï¼Ÿ

ğŸ“Œ **é€‚ç”¨åœºæ™¯ï¼š**
- ç¼–è¯‘å™¨ä¸­çš„è¡¨è¾¾å¼è§£æ
- JSON/XML è§£æå™¨
- ä»»ä½•æ¶‰åŠåµŒå¥—ç»“æ„è§£æçš„é—®é¢˜

è¿™ä¸ªé—®é¢˜å¾ˆå¥½åœ°å±•ç¤ºäº†**æ ˆæ•°æ®ç»“æ„åœ¨å¤„ç†åµŒå¥—/é€’å½’ç»“æ„æ—¶çš„ä¼˜åŠ¿**ï¼Œæ˜¯ç†è§£æ ˆåº”ç”¨çš„ç»å…¸ä¾‹é¢˜ã€‚
