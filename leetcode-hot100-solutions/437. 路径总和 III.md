#  é—®é¢˜ç®€ä»‹

[LeetCode 437. è·¯å¾„æ€»å’Œ III](https://leetcode.cn/problems/path-sum-iii?envType=problem-list-v2&envId=2cktkvj)

## é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ `root` å’Œä¸€ä¸ªæ•´æ•° `targetSum`ï¼Œæ±‚è¯¥äºŒå‰æ ‘ä¸­ **è·¯å¾„å’Œç­‰äºç»™å®šæ•°å€¼** çš„è·¯å¾„æ€»æ•°ã€‚

**è·¯å¾„** ä¸éœ€è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¹Ÿä¸éœ€è¦åœ¨å¶å­èŠ‚ç‚¹ç»“æŸï¼Œä½†æ˜¯è·¯å¾„æ–¹å‘å¿…é¡»æ˜¯ **å‘ä¸‹çš„**ï¼ˆåªèƒ½ä»çˆ¶èŠ‚ç‚¹åˆ°å­èŠ‚ç‚¹ï¼‰ã€‚

______________________________________________________________________

# ğŸ“Œ ç¤ºä¾‹è¯´æ˜

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šroot = [10,5,-3,3,2,null,11,3,-2,null,1], targetSum = 8
è¾“å‡ºï¼š3
è§£é‡Šï¼šå’Œä¸º 8 çš„è·¯å¾„æœ‰ï¼š
1. 5 -> 3
2. 5 -> 2 -> 1
3. -3 -> 11
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šroot = [5,4,8,11,null,13,4,7,2,null,null,5,1], targetSum = 22
è¾“å‡ºï¼š3
```

______________________________________________________________________

# ğŸ’¡ è§£é¢˜æ€è·¯

æœ¬é¢˜çš„å…³é”®åœ¨äºï¼š**è·¯å¾„å¯ä»¥èµ·å§‹äºä»»æ„èŠ‚ç‚¹ï¼Œä½†å¿…é¡»å‘ä¸‹å»¶ä¼¸**ã€‚å› æ­¤ä¸èƒ½ç®€å•åœ°ç”¨ä¸€æ¬¡ DFS åˆ¤æ–­ä»æ ¹å‡ºå‘çš„è·¯å¾„ã€‚

## æ–¹æ³•ä¸€ï¼šåŒé‡é€’å½’ï¼ˆæš´åŠ›æ³•ï¼‰

### æ€è·¯æ­¥éª¤ï¼š

1. å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œéƒ½å°è¯•ä»¥å®ƒä¸ºèµ·ç‚¹ï¼Œå‘ä¸‹æœç´¢æ‰€æœ‰å¯èƒ½è·¯å¾„ã€‚
1. ä½¿ç”¨ä¸€ä¸ªè¾…åŠ©å‡½æ•° `dfs(node, currentSum)`ï¼Œè¡¨ç¤ºä»å½“å‰èŠ‚ç‚¹å¼€å§‹ï¼Œç´¯è®¡å’Œä¸º `currentSum` çš„è·¯å¾„æ•°é‡ã€‚
1. ä¸»å‡½æ•°éå†æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå‰åºéå†ï¼‰ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹è°ƒç”¨è¾…åŠ©å‡½æ•°ã€‚
1. ç´¯åŠ æ‰€æœ‰æ»¡è¶³ `currentSum == targetSum` çš„è·¯å¾„æ•°é‡ã€‚

âœ… ä¼˜ç‚¹ï¼šæ€è·¯ç›´è§‚\
âŒ ç¼ºç‚¹ï¼šæ—¶é—´å¤æ‚åº¦é«˜ï¼Œå­˜åœ¨å¤§é‡é‡å¤è®¡ç®—

______________________________________________________________________

## æ–¹æ³•äºŒï¼šå‰ç¼€å’Œ + å“ˆå¸Œè¡¨ï¼ˆæ¨èï¼‰

### æ ¸å¿ƒæ€æƒ³ï¼š

åˆ©ç”¨**å‰ç¼€å’Œ**çš„æ€æƒ³ï¼š

> å¦‚æœä»æ ¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„å’Œä¸º `currSum`ï¼Œè€Œä¹‹å‰æŸå¤„çš„å‰ç¼€å’Œä¸º `currSum - targetSum`ï¼Œé‚£ä¹ˆè¿™ä¸¤ç‚¹ä¹‹é—´çš„è·¯å¾„å’Œå°±æ˜¯ `targetSum`ã€‚

### æ­¥éª¤è¯¦è§£ï¼š

1. ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ `prefixMap` è®°å½•ä»æ ¹åˆ°å½“å‰è·¯å¾„ä¸Šï¼Œå„ä¸ªå‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°ã€‚
1. åˆå§‹åŒ– `prefixMap{0: 1}`ï¼Œè¡¨ç¤ºå‰ç¼€å’Œä¸º 0 å‡ºç° 1 æ¬¡ï¼ˆç©ºè·¯å¾„ï¼‰ã€‚
1. é€’å½’éå†æ ‘ï¼ˆDFSï¼‰ï¼Œç»´æŠ¤å½“å‰è·¯å¾„çš„å‰ç¼€å’Œ `currSum`ã€‚
1. å¯¹äºå½“å‰èŠ‚ç‚¹ï¼š
   - è®¡ç®— `currSum += node.val`
   - æŸ¥æ‰¾ `prefixMap[currSum - targetSum]`ï¼Œå³æœ‰å¤šå°‘æ¡è·¯å¾„æ»¡è¶³æ¡ä»¶
   - å°† `currSum` åŠ å…¥å“ˆå¸Œè¡¨
   - é€’å½’å·¦å³å­æ ‘
   - **å›æº¯**ï¼šä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤å½“å‰ `currSum`ï¼ˆå› ä¸ºè¦è¿”å›ä¸Šä¸€å±‚ï¼Œè·¯å¾„æ”¹å˜ï¼‰

âœ… ä¼˜ç‚¹ï¼šæ—¶é—´å¤æ‚åº¦ä½ï¼Œåªéå†ä¸€æ¬¡æ ‘\
âœ… å…³é”®ï¼š**å›æº¯æ—¶è¦æ¢å¤å“ˆå¸Œè¡¨çŠ¶æ€**ï¼Œé¿å…è·¨åˆ†æ”¯æ±¡æŸ“

______________________________________________________________________

# ğŸ’» ä»£ç å®ç°

<div class="code-tabs">

```java:Java
// æ–¹æ³•ä¸€ï¼šåŒé‡é€’å½’ï¼ˆæš´åŠ›ï¼‰
class Solution {
    public int pathSum(TreeNode root, int targetSum) {
        if (root == null) return 0;
        return dfs(root, targetSum) + 
               pathSum(root.left, targetSum) + 
               pathSum(root.right, targetSum);
    }

    private int dfs(TreeNode node, long targetSum) {
        if (node == null) return 0;
        int count = 0;
        if (node.val == targetSum) count++;
        count += dfs(node.left, targetSum - node.val);
        count += dfs(node.right, targetSum - node.val);
        return count;
    }
}

// æ–¹æ³•äºŒï¼šå‰ç¼€å’Œ + å“ˆå¸Œè¡¨ï¼ˆæ¨èï¼‰
class Solution {
    public int pathSum(TreeNode root, int targetSum) {
        Map<Long, Integer> prefixMap = new HashMap<>();
        prefixMap.put(0L, 1); // åˆå§‹åŒ–å‰ç¼€å’Œä¸º0çš„è·¯å¾„æ•°
        return dfs(root, 0L, targetSum, prefixMap);
    }

    private int dfs(TreeNode node, long currSum, int targetSum, Map<Long, Integer> prefixMap) {
        if (node == null) return 0;
        
        currSum += node.val;
        int count = prefixMap.getOrDefault(currSum - targetSum, 0);
        
        prefixMap.put(currSum, prefixMap.getOrDefault(currSum, 0) + 1);
        
        count += dfs(node.left, currSum, targetSum, prefixMap);
        count += dfs(node.right, currSum, targetSum, prefixMap);
        
        // å›æº¯ï¼šç§»é™¤å½“å‰è·¯å¾„çš„å‰ç¼€å’Œ
        prefixMap.put(currSum, prefixMap.get(currSum) - 1);
        
        return count;
    }
}
```

```go:Go
// æ–¹æ³•ä¸€ï¼šåŒé‡é€’å½’ï¼ˆæš´åŠ›ï¼‰
func pathSum(root *TreeNode, targetSum int) int {
    if root == nil {
        return 0
    }
    return dfs(root, targetSum) + 
           pathSum(root.Left, targetSum) + 
           pathSum(root.Right, targetSum)
}

func dfs(node *TreeNode, targetSum int) int {
    if node == nil {
        return 0
    }
    count := 0
    if node.Val == targetSum {
        count++
    }
    count += dfs(node.Left, targetSum-node.Val)
    count += dfs(node.Right, targetSum-node.Val)
    return count
}

// æ–¹æ³•äºŒï¼šå‰ç¼€å’Œ + å“ˆå¸Œè¡¨ï¼ˆæ¨èï¼‰
func pathSum(root *TreeNode, targetSum int) int {
    prefixMap := map[int64]int{0: 1}
    return dfsWithPrefix(root, 0, int64(targetSum), prefixMap)
}

func dfsWithPrefix(node *TreeNode, currSum int64, targetSum int64, prefixMap map[int64]int) int {
    if node == nil {
        return 0
    }
    
    currSum += int64(node.Val)
    count := prefixMap[currSum-targetSum]
    
    prefixMap[currSum]++
    
    count += dfsWithPrefix(node.Left, currSum, targetSum, prefixMap)
    count += dfsWithPrefix(node.Right, currSum, targetSum, prefixMap)
    
    // å›æº¯
    prefixMap[currSum]--
    
    return count
}
```

</div>

______________________________________________________________________

# ğŸ§ª ç¤ºä¾‹æ¼”ç¤ºï¼ˆä»¥å‰ç¼€å’Œæ–¹æ³•ä¸ºä¾‹ï¼‰

ä»¥ `root = [10,5,-3,3,2,null,11,3,-2,null,1], targetSum = 8` ä¸ºä¾‹ï¼š

- ä»æ ¹ 10 å¼€å§‹ï¼Œ`currSum = 10`
- åˆ° 5ï¼Œ`currSum = 15`ï¼Œæ£€æŸ¥ `15 - 8 = 7` æ˜¯å¦åœ¨ map ä¸­ï¼ˆå¦ï¼‰
- åˆ° 3ï¼Œ`currSum = 18`ï¼Œæ£€æŸ¥ `18 - 8 = 10` â†’ å­˜åœ¨ï¼ï¼ˆè·¯å¾„ 5â†’3ï¼‰
- å›æº¯ååˆ° 2ï¼Œ`currSum = 17`ï¼Œæ£€æŸ¥ `17 - 8 = 9`ï¼ˆå¦ï¼‰
- åˆ° 1ï¼Œ`currSum = 18`ï¼Œæ£€æŸ¥ `18 - 8 = 10` â†’ å­˜åœ¨ï¼ï¼ˆè·¯å¾„ 5â†’2â†’1ï¼‰
- å³å­æ ‘ -3 â†’ 11ï¼Œ`currSum = 18`ï¼ŒåŒæ · `18 - 8 = 10` â†’ å­˜åœ¨ï¼ï¼ˆè·¯å¾„ -3â†’11ï¼‰

å…± 3 æ¡è·¯å¾„ âœ…

______________________________________________________________________

# âœ… ç­”æ¡ˆæœ‰æ•ˆæ€§è¯æ˜

- **åŒé‡é€’å½’**ï¼šæšä¸¾æ‰€æœ‰èµ·ç‚¹ + æ‰€æœ‰å‘ä¸‹è·¯å¾„ï¼Œç©·ä¸¾å®Œå¤‡ï¼Œç»“æœæ­£ç¡®ã€‚
- **å‰ç¼€å’Œæ–¹æ³•**ï¼š
  - åˆ©ç”¨â€œè‹¥ `sum[i] - sum[j] = target`ï¼Œåˆ™è·¯å¾„å’Œä¸º targetâ€è¿™ä¸€æ•°å­¦æ€§è´¨ã€‚
  - å“ˆå¸Œè¡¨è®°å½•çš„æ˜¯**å½“å‰è·¯å¾„ä¸Š**çš„å‰ç¼€å’Œï¼Œé€šè¿‡å›æº¯ä¿è¯ä¸è·¨åˆ†æ”¯ã€‚
  - åˆå§‹åŒ– `prefixMap{0:1}` å¤„ç†ä»æ ¹å¼€å§‹çš„è·¯å¾„ï¼ˆå¦‚ `currSum == targetSum` æ—¶ï¼Œ`currSum - targetSum = 0`ï¼‰ã€‚

ä¸¤ç§æ–¹æ³•å‡èƒ½è¦†ç›–æ‰€æœ‰åˆæ³•è·¯å¾„ï¼Œæ— é—æ¼ã€æ— é‡å¤ã€‚

______________________________________________________________________

# ğŸ“Š å¤æ‚åº¦åˆ†æ

| æ–¹æ³• | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | è¯´æ˜ |
|------|-----------|-----------|------|
| åŒé‡é€’å½’ | $O(N^2)$ | $O(H)$ | æœ€åæƒ…å†µï¼ˆé“¾è¡¨ï¼‰æ¯å±‚éå† N, N-1, ..., 1 |
| å‰ç¼€å’Œ + å“ˆå¸Œè¡¨ | $O(N)$ | $O(H)$ | æ¯ä¸ªèŠ‚ç‚¹è®¿é—®ä¸€æ¬¡ï¼Œå“ˆå¸Œè¡¨æœ€å¤šå­˜ H ä¸ªå€¼ï¼ˆH ä¸ºæ ‘é«˜ï¼‰ |

> å…¶ä¸­ $N$ ä¸ºèŠ‚ç‚¹æ•°ï¼Œ$H$ ä¸ºæ ‘çš„é«˜åº¦ï¼ˆå¹³è¡¡æ ‘ $H = \\log N$ï¼Œé€€åŒ–ä¸ºé“¾è¡¨æ—¶ $H = N$ï¼‰

______________________________________________________________________

# ğŸ“Œ é—®é¢˜æ€»ç»“

- **å…³é”®æ´å¯Ÿ**ï¼šè·¯å¾„ä¸è¦æ±‚ä»æ ¹å¼€å§‹ï¼Œä½†å¿…é¡»å‘ä¸‹ â†’ å¯è½¬åŒ–ä¸ºâ€œä»»æ„èµ·ç‚¹ + å‘ä¸‹å»¶ä¼¸â€ã€‚
- **æš´åŠ›æ³•**é€‚ç”¨äºå°è§„æ¨¡æ•°æ®ï¼Œé€»è¾‘æ¸…æ™°ä½†æ•ˆç‡ä½ã€‚
- **å‰ç¼€å’Œ + å“ˆå¸Œè¡¨**æ˜¯æœ¬é¢˜æœ€ä¼˜è§£ï¼Œæ ¸å¿ƒåœ¨äºï¼š
  - åˆ©ç”¨å‰ç¼€å’Œå·®å€¼å¿«é€Ÿåˆ¤æ–­è·¯å¾„å’Œ
  - **å›æº¯æ—¶æ¢å¤å“ˆå¸Œè¡¨çŠ¶æ€**ï¼Œé¿å…ä¸åŒåˆ†æ”¯é—´å¹²æ‰°
- æ­¤æŠ€å·§å¯æ¨å¹¿è‡³å…¶ä»–â€œè·¯å¾„å’Œâ€ç±»é—®é¢˜ï¼ˆå¦‚æ•°ç»„å­æ•°ç»„å’Œä¸º Kï¼‰ã€‚

> ğŸ’¡ **æç¤º**ï¼šé‡åˆ°â€œä»»æ„èµ·ç‚¹ã€è¿ç»­ã€å’Œä¸º Kâ€ç±»é—®é¢˜ï¼Œä¼˜å…ˆè€ƒè™‘å‰ç¼€å’Œï¼
