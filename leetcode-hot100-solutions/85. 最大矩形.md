# 85. æœ€å¤§çŸ©å½¢

[LeetCode é¢˜ç›®é“¾æ¥](https://leetcode.cn/problems/maximal-rectangle?envType=problem-list-v2&envId=2cktkvj)

##  é—®é¢˜ç®€ä»‹

ç»™å®šä¸€ä¸ªä»…åŒ…å« `0` å’Œ `1` çš„äºŒç»´äºŒè¿›åˆ¶çŸ©é˜µï¼Œæ‰¾å‡ºåªåŒ…å« `1` çš„æœ€å¤§çŸ©å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚

### é¢˜ç›®æè¿°

åœ¨ä¸€ä¸ªç”± `'0'` å’Œ `'1'` ç»„æˆçš„äºŒç»´çŸ©é˜µå†…ï¼Œæ‰¾åˆ°åªåŒ…å« `'1'` çš„æœ€å¤§çŸ©å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚

______________________________________________________________________

## ğŸ“Œ ç¤ºä¾‹è¯´æ˜

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼š
matrix = [
  ["1","0","1","0","0"],
  ["1","0","1","1","1"],
  ["1","1","1","1","1"],
  ["1","0","0","1","0"]
]
è¾“å‡ºï¼š6
è§£é‡Šï¼šæœ€å¤§çŸ©å½¢å¦‚å›¾æ‰€ç¤ºï¼ˆä½äºç¬¬2ã€3è¡Œï¼Œç¬¬2~4åˆ—ï¼‰ï¼Œé¢ç§¯ä¸º 2Ã—3 = 6ã€‚
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šmatrix = []
è¾“å‡ºï¼š0
```

**ç¤ºä¾‹ 3ï¼š**

```
è¾“å…¥ï¼šmatrix = [["0"]]
è¾“å‡ºï¼š0
```

**ç¤ºä¾‹ 4ï¼š**

```
è¾“å…¥ï¼šmatrix = [["1"]]
è¾“å‡ºï¼š1
```

______________________________________________________________________

## ğŸ’¡ è§£é¢˜æ€è·¯

æœ¬é¢˜æ˜¯ [84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢](https://leetcode.cn/problems/largest-rectangle-in-histogram/) çš„äºŒç»´æ‰©å±•ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**å°†äºŒç»´é—®é¢˜è½¬åŒ–ä¸ºå¤šä¸ªä¸€ç»´æŸ±çŠ¶å›¾é—®é¢˜**ã€‚

### æ–¹æ³•ä¸€ï¼šåŸºäºæŸ±çŠ¶å›¾çš„æœ€å¤§çŸ©å½¢ï¼ˆæ¨èï¼‰

#### æ­¥éª¤è¯¦è§£ï¼š

1. **æ„å»ºé«˜åº¦æ•°ç»„**\
   å¯¹äºæ¯ä¸€è¡Œï¼Œè®¡ç®—ä»¥è¯¥è¡Œä¸ºåº•è¾¹çš„â€œæŸ±çŠ¶å›¾â€é«˜åº¦ã€‚

   - å¦‚æœ `matrix[i][j] == '1'`ï¼Œåˆ™ `heights[j] += 1`
   - å¦åˆ™ `heights[j] = 0`ï¼ˆå› ä¸ºçŸ©å½¢ä¸èƒ½åŒ…å« 0ï¼‰

1. **å¯¹æ¯ä¸€è¡Œè°ƒç”¨â€œæŸ±çŠ¶å›¾æœ€å¤§çŸ©å½¢â€ç®—æ³•**\
   ä½¿ç”¨å•è°ƒæ ˆæ–¹æ³•ï¼ˆå‚è€ƒ LeetCode 84 é¢˜ï¼‰æ±‚å½“å‰ `heights` æ•°ç»„å¯¹åº”çš„æœ€å¤§çŸ©å½¢é¢ç§¯ã€‚

1. **æ›´æ–°å…¨å±€æœ€å¤§å€¼**

#### ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ

- æ¯ä¸€è¡Œçš„é«˜åº¦æ•°ç»„ä»£è¡¨äº†ä»è¯¥è¡Œå‘ä¸Šå»¶ä¼¸çš„è¿ç»­ `'1'` çš„æ•°é‡ã€‚
- è¿™æ ·ï¼Œä»»ä½•åªåŒ…å« `'1'` çš„çŸ©å½¢éƒ½ä¼šè¢«æŸä¸€è¡Œçš„æŸ±çŠ¶å›¾æ‰€æ•è·ã€‚

______________________________________________________________________

### æ–¹æ³•äºŒï¼šæš´åŠ›æšä¸¾ï¼ˆä¸æ¨èï¼Œä»…ä½œç†è§£ï¼‰

- æšä¸¾æ‰€æœ‰å¯èƒ½çš„å·¦ä¸Šè§’ `(i, j)` å’Œå³ä¸‹è§’ `(k, l)`ï¼Œæ£€æŸ¥å­çŸ©é˜µæ˜¯å¦å…¨ä¸º `'1'`ã€‚
- æ—¶é—´å¤æ‚åº¦é«˜è¾¾ O(mÂ²nÂ²)ï¼Œä¼šè¶…æ—¶ã€‚

______________________________________________________________________

### æ–¹æ³•ä¸‰ï¼šåŠ¨æ€è§„åˆ’ï¼ˆè®°å½•å·¦å³è¾¹ç•Œï¼‰

- å¯¹æ¯ä¸€è¡Œç»´æŠ¤ä¸‰ä¸ªæ•°ç»„ï¼š`height`, `left`, `right`
- `height[j]`ï¼šå½“å‰åˆ—é«˜åº¦
- `left[j]`ï¼šå½“å‰é«˜åº¦ä¸‹ï¼Œèƒ½å‘å·¦æ‰©å±•çš„æœ€è¿œä½ç½®
- `right[j]`ï¼šå½“å‰é«˜åº¦ä¸‹ï¼Œèƒ½å‘å³æ‰©å±•çš„æœ€è¿œä½ç½®
- é¢ç§¯ = `height[j] * (right[j] - left[j])`
- å®ç°è¾ƒå¤æ‚ï¼Œä½†ä¹Ÿæ˜¯ O(mn) æ—¶é—´

> â­ æœ¬æ–‡é‡ç‚¹è®²è§£ **æ–¹æ³•ä¸€ï¼ˆæŸ±çŠ¶å›¾ + å•è°ƒæ ˆï¼‰**ï¼Œå› å…¶æ€è·¯æ¸…æ™°ã€ä»£ç ç®€æ´ã€æ•ˆç‡é«˜ã€‚

______________________________________________________________________

## ğŸ’» ä»£ç å®ç°


```java
import java.util.*;

public class Solution {
    public int maximalRectangle(char[][] matrix) {
        if (matrix == null || matrix.length == 0 || matrix[0].length == 0) {
            return 0;
        }
        
        int m = matrix.length;
        int n = matrix[0].length;
        int[] heights = new int[n];
        int maxArea = 0;
        
        for (int i = 0; i < m; i++) {
            // æ›´æ–°é«˜åº¦æ•°ç»„
            for (int j = 0; j < n; j++) {
                if (matrix[i][j] == '1') {
                    heights[j]++;
                } else {
                    heights[j] = 0;
                }
            }
            // è®¡ç®—å½“å‰è¡Œå¯¹åº”çš„æœ€å¤§çŸ©å½¢é¢ç§¯
            maxArea = Math.max(maxArea, largestRectangleArea(heights));
        }
        
        return maxArea;
    }
    
    // LeetCode 84: æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢
    private int largestRectangleArea(int[] heights) {
        Stack<Integer> stack = new Stack<>();
        int maxArea = 0;
        int n = heights.length;
        
        for (int i = 0; i <= n; i++) {
            int h = (i == n) ? 0 : heights[i];
            while (!stack.isEmpty() && heights[stack.peek()] > h) {
                int height = heights[stack.pop()];
                int width = stack.isEmpty() ? i : i - stack.peek() - 1;
                maxArea = Math.max(maxArea, height * width);
            }
            stack.push(i);
        }
        
        return maxArea;
    }
}
```

```go
func maximalRectangle(matrix [][]byte) int {
    if len(matrix) == 0 || len(matrix[0]) == 0 {
        return 0
    }
    
    m, n := len(matrix), len(matrix[0])
    heights := make([]int, n)
    maxArea := 0
    
    for i := 0; i < m; i++ {
        // æ›´æ–°é«˜åº¦æ•°ç»„
        for j := 0; j < n; j++ {
            if matrix[i][j] == '1' {
                heights[j]++
            } else {
                heights[j] = 0
            }
        }
        // è®¡ç®—å½“å‰è¡Œçš„æœ€å¤§çŸ©å½¢é¢ç§¯
        maxArea = max(maxArea, largestRectangleArea(heights))
    }
    
    return maxArea
}

// æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ï¼ˆLeetCode 84ï¼‰
func largestRectangleArea(heights []int) int {
    stack := []int{}
    maxArea := 0
    n := len(heights)
    
    for i := 0; i <= n; i++ {
        h := 0
        if i < n {
            h = heights[i]
        }
        
        for len(stack) > 0 && heights[stack[len(stack)-1]] > h {
            height := heights[stack[len(stack)-1]]
            stack = stack[:len(stack)-1]
            width := i
            if len(stack) > 0 {
                width = i - stack[len(stack)-1] - 1
            }
            maxArea = max(maxArea, height*width)
        }
        stack = append(stack, i)
    }
    
    return maxArea
}

func max(a, b int) int {
    if a > b {
        return a
    }
    return b
}
```

______________________________________________________________________

## ğŸ¯ ç¤ºä¾‹æ¼”ç¤º

ä»¥ç¤ºä¾‹ 1 ä¸ºä¾‹ï¼š

```
matrix = [
  ["1","0","1","0","0"],
  ["1","0","1","1","1"],
  ["1","1","1","1","1"],
  ["1","0","0","1","0"]
]
```

é€è¡Œæ„å»º `heights` å¹¶è®¡ç®—æœ€å¤§é¢ç§¯ï¼š

| è¡Œ | heights æ•°ç»„ | å½“å‰è¡Œæœ€å¤§é¢ç§¯ |
|----|--------------|----------------|
| 0 | [1,0,1,0,0] | 1 |
| 1 | [2,0,2,1,1] | 3 |
| 2 | [3,1,3,2,2] | **6** âœ… |
| 3 | [4,0,0,3,0] | 4 |

æœ€ç»ˆç­”æ¡ˆï¼š**6**

______________________________________________________________________

## âœ… ç­”æ¡ˆæœ‰æ•ˆæ€§è¯æ˜

1. **å®Œå¤‡æ€§**ï¼š\
   ä»»æ„ä¸€ä¸ªå…¨ `'1'` çŸ©å½¢ï¼Œå…¶åº•è¾¹å¿…ç„¶è½åœ¨æŸä¸€è¡Œ `i` ä¸Šã€‚æ­¤æ—¶è¯¥çŸ©å½¢çš„é«˜åº¦ â‰¤ `heights[j]`ï¼ˆå¯¹æ‰€æœ‰åˆ— `j` åœ¨çŸ©å½¢èŒƒå›´å†…ï¼‰ã€‚å› æ­¤ï¼Œè¯¥çŸ©å½¢ä¼šè¢«ç¬¬ `i` è¡Œçš„æŸ±çŠ¶å›¾ç®—æ³•è€ƒè™‘ã€‚

1. **æ­£ç¡®æ€§**ï¼š\
   `largestRectangleArea` å‡½æ•°å·²è¢« LeetCode 84 éªŒè¯æ­£ç¡®ï¼Œèƒ½å‡†ç¡®è®¡ç®—æŸ±çŠ¶å›¾æœ€å¤§çŸ©å½¢ã€‚

1. **æ— é—æ¼**ï¼š\
   æˆ‘ä»¬éå†äº†æ‰€æœ‰è¡Œä½œä¸ºåº•è¾¹ï¼Œå› æ­¤ä¸ä¼šé—æ¼ä»»ä½•å¯èƒ½çš„æœ€å¤§çŸ©å½¢ã€‚

______________________________________________________________________

## ğŸ“Š å¤æ‚åº¦åˆ†æ

| é¡¹ç›® | å¤æ‚åº¦ |
|------|--------|
| æ—¶é—´å¤æ‚åº¦ | O(m Ã— n) <br> æ¯è¡Œå¤„ç† `n` ä¸ªå…ƒç´ ï¼Œå…± `m` è¡Œï¼›æ¯è¡Œè°ƒç”¨ `largestRectangleArea` ä¸º O(n) |
| ç©ºé—´å¤æ‚åº¦ | O(n) <br> ä»…éœ€ `heights` æ•°ç»„å’Œå•è°ƒæ ˆï¼Œå¤§å°ä¸º `n` |

> ğŸ’¡ ç›¸æ¯”æš´åŠ›æ³• O(mÂ²nÂ²)ï¼Œæ­¤è§£æ³•æ•ˆç‡æé«˜ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡è¾“å…¥ã€‚

______________________________________________________________________

## ğŸ§  é—®é¢˜æ€»ç»“

- **æ ¸å¿ƒæ€æƒ³**ï¼šé™ç»´â€”â€”å°†äºŒç»´æœ€å¤§çŸ©å½¢é—®é¢˜è½¬åŒ–ä¸ºå¤šä¸ªä¸€ç»´æŸ±çŠ¶å›¾é—®é¢˜ã€‚
- **å…³é”®æŠ€æœ¯**ï¼šå•è°ƒæ ˆç”¨äºé«˜æ•ˆè®¡ç®—æŸ±çŠ¶å›¾æœ€å¤§çŸ©å½¢ã€‚
- **é€šç”¨æ¨¡å¼**ï¼šæ­¤ç±»â€œäºŒç»´è½¬ä¸€ç»´â€æŠ€å·§åœ¨çŸ©é˜µç±» DP/å•è°ƒæ ˆé—®é¢˜ä¸­éå¸¸å¸¸è§ï¼ˆå¦‚æ¥é›¨æ°´ IIã€æœ€å¤§æ­£æ–¹å½¢ç­‰ï¼‰ã€‚
- **æ‰©å±•æ€è€ƒ**ï¼šè‹¥çŸ©é˜µå…ƒç´ ä¸ºæ•´æ•°è€Œé 0/1ï¼Œå¯ç±»ä¼¼å®šä¹‰â€œé«˜åº¦â€ä¸ºæ»¡è¶³æŸç§æ¡ä»¶çš„è¿ç»­å€¼ã€‚

> âœ… æŒæ¡æ­¤é¢˜ï¼Œç­‰äºåŒæ—¶æŒæ¡ **LeetCode 84 + 85**ï¼Œæ˜¯å•è°ƒæ ˆä¸çŸ©é˜µå¤„ç†çš„ç»å…¸ç»„åˆï¼
